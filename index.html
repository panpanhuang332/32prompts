<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ICS Prompt Lab Pro - V6.5 Full Integration</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = { darkMode: 'media' }
    </script>

    <style>
        body { -webkit-tap-highlight-color: transparent; transition: background-color 0.4s ease; }
        .app-card { border-radius: 32px; transition: all 0.3s ease; }
        .gradient-header { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        @media (prefers-color-scheme: dark) { body { background-color: #0f172a; } }
        @keyframes dice-roll { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .rolling { animation: dice-roll 0.5s ease-in-out; }
        select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 1.2rem center; background-repeat: no-repeat; background-size: 1.2em; }
    </style>
</head>
<body class="p-4 bg-slate-50 dark:bg-slate-900 min-h-screen font-sans pb-10 flex justify-center items-start">

    <div class="w-full max-w-md bg-white dark:bg-slate-800 app-card shadow-2xl overflow-hidden border border-gray-100 dark:border-slate-700">
        <div class="p-9 gradient-header text-white relative">
            <h1 class="text-3xl font-black flex items-center gap-3 relative z-10">
                <i class="fas fa-wand-sparkles text-yellow-300"></i> ICS Lab Pro
            </h1>
            <p class="text-indigo-100 text-[10px] mt-2 font-bold tracking-[0.3em] opacity-90 uppercase relative z-10">V6.5 Full Integration</p>
            
            <button onclick="randomStyleOnly()" class="absolute bottom-6 right-6 bg-white/20 hover:bg-white/30 backdrop-blur-md p-3 rounded-2xl border border-white/30 transition-all active:scale-90 group shadow-lg">
                <i id="diceIcon" class="fas fa-dice text-2xl text-white group-hover:rotate-12 transition-transform"></i>
            </button>
        </div>

        <div class="p-7 space-y-7">
            <section>
                <label class="text-[10px] font-black text-indigo-500 dark:text-indigo-400 mb-3 block tracking-[0.2em] uppercase">Step 01. åœ–ç‰‡é¡å‹ (Image Type)</label>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="vibrate(); setType('general', this)" class="type-btn ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/40 p-3 rounded-xl text-indigo-700 dark:text-indigo-300 text-[10px] font-bold transition-all">é€šç”¨åœ–åƒ</button>
                    <button onclick="vibrate(); setType('infographic', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">è³‡è¨Šåœ–è¡¨</button>
                    <button onclick="vibrate(); setType('diagram', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">åŠŸèƒ½åœ–è§£</button>
                    <button onclick="vibrate(); setType('flowchart', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">æµç¨‹åœ–</button>
                    <button onclick="vibrate(); setType('portrait', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">äººåƒæ”å½±</button>
                    <button onclick="vibrate(); setType('landscape', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">å£¯é—Šé¢¨æ™¯</button>
                </div>
            </section>

            <section>
                <label class="text-[10px] font-black text-indigo-500 dark:text-indigo-400 mb-3 block tracking-[0.2em] uppercase">Step 02. å…§å®¹ä¸»é¡Œ (Content)</label>
                <textarea id="content" rows="2" placeholder="è¼¸å…¥ä¸»é¡Œå…§å®¹..." 
                       class="w-full p-5 bg-gray-50 dark:bg-slate-900/50 border border-gray-100 dark:border-slate-700 rounded-2xl focus:ring-2 focus:ring-indigo-500 outline-none text-gray-700 dark:text-slate-200 transition-all text-base shadow-inner"></textarea>
            </section>

            <section>
                <label class="text-[10px] font-black text-indigo-500 dark:text-indigo-400 mb-3 block tracking-[0.2em] uppercase">Step 03. è¦–è¦ºé¢¨æ ¼ (Visual Style)</label>
                <select id="style" onchange="vibrate(); updatePreview()" class="w-full p-5 bg-gray-50 dark:bg-slate-900/50 border border-gray-100 dark:border-slate-700 rounded-2xl font-bold text-gray-700 dark:text-slate-200 mb-4 outline-none text-base shadow-sm">
                    <option value="" disabled selected>è«‹é¸æ“‡é¢¨æ ¼...</option>
                    
                    <optgroup label="ğŸ“¸ æ”å½±æ¨¡å¼ (Photography 1.png)">
                        <option value="photo">æ¨™æº–ç…§ç‰‡ Photo</option>
                        <option value="life photo">ç”Ÿæ´»ç…§ Life Photo</option>
                        <option value="group photo">åœ˜é«”ç…§ Group Photo</option>
                        <option value="group selfie photo">è‡ªæ‹åœ˜ç…§ Group Selfie</option>
                        <option value="portrait photography">äººåƒæ”å½± Portrait</option>
                        <option value="ports photography">é‹å‹•æ”å½± Sports</option>
                        <option value="still life photo">éœç‰©æ”å½± Still Life</option>
                    </optgroup>

                    <optgroup label="ğŸ‘ï¸ é¡é ­èˆ‡ç„¦è· (Oxxo Specs)">
                        <option value="macro lens">å¾®è·é¡é ­ Macro (ç´°ç¯€)</option>
                        <option value="wide angle lens">å»£è§’é¡é ­ Wide Angle</option>
                        <option value="fish eye lens">é­šçœ¼é¡é ­ Fish-eye</option>
                        <option value="tilt shift lens">ç§»è»¸é¡é ­ Tilt-shift</option>
                        <option value="telephoto lens">æœ›é é¡é ­ Telephoto</option>
                    </optgroup>

                    <optgroup label="ğŸ¬ æ”å½±é¢¨æ ¼ (Oxxo Specs)">
                        <option value="Cinematic">é›»å½±åŠ‡ç…§ Cinematic</option>
                        <option value="DSLR style">å–®çœ¼é¢¨æ ¼ DSLR</option>
                        <option value="Polaroid style">æ‹ç«‹å¾— Polaroid</option>
                        <option value="GoPro style">GoPro é‹å‹•è¦–è§’</option>
                        <option value="Fujifilm style">å¯Œå£«åº•ç‰‡æ„Ÿ Fujifilm</option>
                        <option value="LOMO style">LOMO æ¿¾é¡æ„Ÿ</option>
                    </optgroup>

                    <optgroup label="ğŸ¨ è—è¡“èˆ‡åª’æ (æç¤ºè©.png)">
                        <option value="Oil Painting">æ²¹ç•«é¢¨ Oil Painting</option>
                        <option value="Watercolor">æ°´å½©é¢¨ Watercolor</option>
                        <option value="Hand-drawn Sketch">ç´ æé¢¨ Sketch</option>
                        <option value="Surreal">è¶…ç¾å¯¦ Surreal</option>
                        <option value="Chinese Ink">æ±æ–¹æ°´å¢¨ Ink</option>
                        <option value="Ukiyo-e">æ—¥æœ¬æµ®ä¸–ç¹ª</option>
                    </optgroup>

                    <optgroup label="âœ¨ ç‰¹è‰²å‰µä½œ (æç¤ºè©.png)">
                        <option value="Logo">æ¨™èªŒè¨­è¨ˆ LOGO</option>
                        <option value="Poster">å»£å‘Šæµ·å ± Poster</option>
                        <option value="Interior">å®¤å…§è¨­è¨ˆ Interior</option>
                        <option value="Anime">å‹•æ¼«é¢¨ Anime</option>
                        <option value="Cyberpunk">è³½åšé¾å…‹ Cyberpunk</option>
                    </optgroup>

                    <optgroup label="ğŸ’¼ å°ˆæ¥­èˆ‡è¶£å‘³ (Original 32)">
                        <option value="McKinsey">é¡§å•é¢¨ McKinsey</option>
                        <option value="Isometric 3D">ç­‰è·é¢¨ Isometric</option>
                        <option value="Claymation">é»åœŸé¢¨ Claymation</option>
                        <option value="Diorama">å°å±‹é¢¨ Diorama</option>
                        <option value="LEGO">æ¨‚é«˜é¢¨ LEGO</option>
                    </optgroup>
                </select>

                <div id="previewCard" class="hidden p-4 rounded-2xl bg-indigo-50 dark:bg-slate-900 border border-indigo-100 dark:border-slate-700 animate-in fade-in slide-in-from-top-2 duration-300">
                    <p id="previewText" class="text-xs text-indigo-700 dark:text-indigo-300 leading-relaxed font-bold"></p>
                </div>
            </section>

            <section>
                <label class="text-[10px] font-black text-indigo-500 dark:text-indigo-400 mb-3 block tracking-[0.2em] uppercase">Step 04. é•·å¯¬æ¯”ä¾‹ (Aspect Ratio)</label>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setRatio('1:1', this)" class="ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">1:1 (è²¼æ–‡)</button>
                    <button onclick="setRatio('4:5', this)" class="ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">4:5 (IGå‚ç›´)</button>
                    <button id="defaultRatioBtn" onclick="setRatio('9:16', this)" class="ratio-btn ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/40 p-3 rounded-xl text-indigo-700 dark:text-indigo-300 text-[10px] font-bold transition-all shadow-sm">9:16 (çŸ­å½±éŸ³)</button>
                    <button onclick="setRatio('16:9', this)" class="ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">16:9 (å½±ç‰‡)</button>
                    <button onclick="setRatio('3:2', this)" class="ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">3:2 (æ”å½±)</button>
                    <button onclick="setRatio('21:9', this)" class="ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">21:9 (Notion)</button>
                </div>
                <div id="arHint" class="mt-2 text-[9px] text-gray-400 dark:text-slate-500 italic text-center">é©ç”¨ï¼šReelsã€TikTokã€Stories æ‰‹æ©Ÿå…¨è¢å¹•é«”é©—ã€‚</div>
            </section>

            <button onclick="vibrate(); generate()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-4 rounded-2xl shadow-xl transition-all active:scale-[0.96] flex justify-center items-center gap-2 text-lg">
                ç”Ÿæˆæ‡¶äººæŒ‡ä»¤ <i class="fas fa-magic"></i>
            </button>

            <div id="resultBox" class="hidden animate-in zoom-in-95 duration-300">
                <div class="bg-slate-900 rounded-[2rem] p-7 border border-slate-700 shadow-2xl relative">
                    <p id="finalPrompt" class="text-indigo-200 text-xs font-mono whitespace-pre-line leading-relaxed bg-slate-950/50 p-5 rounded-2xl border border-white/5 shadow-inner mb-6"></p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="vibrate(); copyText()" class="bg-indigo-600 text-white p-4 rounded-xl text-xs font-black transition active:scale-90 flex flex-col items-center gap-1">
                            <i class="far fa-copy text-lg"></i> è¤‡è£½
                        </button>
                        <button onclick="vibrate(); shareLine()" class="bg-[#06C755] text-white p-4 rounded-xl text-xs font-black transition active:scale-90 flex flex-col items-center gap-1">
                            <i class="fab fa-line text-lg"></i> LINE
                        </button>
                        <button onclick="vibrate(); shareFB()" class="bg-[#1877F2] text-white p-4 rounded-xl text-xs font-black transition active:scale-90 flex flex-col items-center gap-1">
                            <i class="fab fa-facebook text-lg"></i> FB
                        </button>
                    </div>
                </div>
            </div>

            <section id="historySection" class="pt-6">
                <div class="flex items-center justify-between mb-4 px-1">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest">æ­·å²ç´€éŒ„ (5ç­†)</label>
                    <button onclick="vibrate(); clearHistory()" class="text-[10px] font-bold text-indigo-500">æ¸…é™¤ç´€éŒ„</button>
                </div>
                <div id="historyList" class="space-y-3"></div>
            </section>
        </div>
    </div>

    <script>
        // åŒ¯ç¸½æ‰€æœ‰é™„ä»¶çš„é¢¨æ ¼æè¿°
        const styleSpecs = {
            // æ”å½±æ¨¡å¼ (æ”å½±1.png)
            "photo": { spec: "Realistic photography style, professional lighting.", desc: "æ¨™æº–æ”å½±ï¼šæœ€é€šç”¨çš„å¯«å¯¦ç…§ç‰‡è³ªæ„Ÿã€‚" },
            "life photo": { spec: "Candid life photo, natural lifestyle, unposed, realistic.", desc: "ç”Ÿæ´»ç…§ï¼šè‡ªç„¶ã€ä¸åˆ»æ„çš„ç”Ÿæ´»æ„Ÿç…§ç‰‡ã€‚" },
            "group photo": { spec: "Group photo, multiple people, clear faces.", desc: "åœ˜é«”ç…§ï¼šå¤šäººåˆç…§ï¼Œæ§‹åœ–ç©©å®šã€‚" },
            "group selfie photo": { spec: "Group selfie style, person holding phone, dynamic.", desc: "è‡ªæ‹åœ˜é«”ç…§ï¼šåƒæ˜¯ä¸€ç¾¤äººç”¨æ‰‹æ©Ÿè‡ªæ‹çš„è¦–è§’ã€‚" },
            "portrait photography": { spec: "Portrait photography, bokeh background, sharp focus on face.", desc: "äººåƒæ”å½±ï¼šå°ˆæ¥­æ£šæ‹æˆ–æˆ¶å¤–äººåƒï¼ŒèƒŒæ™¯è™›åŒ–ã€‚" },
            "ports photography": { spec: "Sports photography, fast shutter speed, motion blur, dynamic action.", desc: "é‹å‹•æ”å½±ï¼šæ•æ‰å‹•æ…‹ç¬é–“çš„é«˜é€Ÿæ”å½±ã€‚" },
            "still life photo": { spec: "Still life photography, controlled studio lighting, artistic arrangement.", desc: "éœç‰©æ”å½±ï¼šç”¢å“æˆ–éœç‰©çš„ç²¾ç·»æ‰“å…‰æ‹æ”ã€‚" },

            // é¡é ­èˆ‡ç„¦è· (Oxxo Specs)
            "macro lens": { spec: "Macro lens photography, extreme close-up, hyper-detailed texture.", desc: "å¾®è·é¡é ­ï¼šæ•æ‰æ¥µç´°å¾®çš„ç´‹ç†èˆ‡ç´°ç¯€ã€‚" },
            "wide angle lens": { spec: "Wide angle lens, expansive view, architectural perspective.", desc: "å»£è§’é¡é ­ï¼šé©åˆæ‹é¢¨æ™¯ã€å»ºç¯‰ï¼Œè¦–é‡é¼é—Šã€‚" },
            "fish eye lens": { spec: "Fish eye lens, panoramic distortion, ultra-wide circular view.", desc: "é­šçœ¼é¡é ­ï¼šèª‡å¼µçš„çƒå½¢æ‰­æ›²ï¼Œè¦–è¦ºå¼µåŠ›å¤§ã€‚" },
            "tilt shift lens": { spec: "Tilt shift lens, miniature effect, selective focus.", desc: "ç§»è»¸é¡é ­ï¼šè®“çœŸå¯¦ä¸–ç•Œçœ‹èµ·ä¾†åƒæ¨¡å‹å°äººåœ‹ã€‚" },

            // æ”å½±é¢¨æ ¼ (Oxxo Specs)
            "Cinematic": { spec: "Cinematic movie style, dramatic lighting, anamorphic look.", desc: "é›»å½±åŠ‡ç…§ï¼šå……æ»¿æ•…äº‹æ„Ÿèˆ‡æˆ²åŠ‡åŒ–çš„å…‰å½±ã€‚" },
            "DSLR style": { spec: "Digital DSLR photography style, high resolution, crisp details.", desc: "å–®çœ¼é¢¨æ ¼ï¼šå°ˆæ¥­æ•¸ä½å–®çœ¼ç›¸æ©Ÿè³ªæ„Ÿã€‚" },
            "Polaroid style": { spec: "Polaroid instant film style, vintage colors, white border.", desc: "æ‹ç«‹å¾—ï¼šå¾©å¤ã€å¸¶æœ‰å³æ‹å³å¾—çš„åº•ç‰‡æ„Ÿã€‚" },
            "Fujifilm style": { spec: "Fujifilm superia style, film grain, iconic color science.", desc: "å¯Œå£«åº•ç‰‡ï¼šç¨ç‰¹çš„è‰²å½©ç§‘å­¸èˆ‡é¡†ç²’æ„Ÿã€‚" },

            // æç¤ºè©.png é¢¨æ ¼
            "Oil Painting": { spec: "Oil painting style, rich brushstrokes, canvas texture.", desc: "æ²¹ç•«é¢¨ï¼šæ¿ƒéƒçš„é¡æ–™è³ªæ„Ÿèˆ‡è—è¡“ç­†è§¸ã€‚" },
            "Watercolor": { spec: "Watercolor painting, soft color wash, flowing ink.", desc: "æ°´å½©é¢¨ï¼šè¼•é€çš„è‰²å¡Šèˆ‡æµå‹•çš„è—è¡“æ„Ÿã€‚" },
            "Hand-drawn Sketch": { spec: "Hand-drawn pencil sketch, rough lines, charcoal texture.", desc: "ç´ æé¢¨ï¼šæ‰‹ç¹ªç·šæ¢æ„Ÿèˆ‡ç‚­ç­†é™°å½±ã€‚" },
            "Surreal": { spec: "Surrealism art style, dreamlike elements, bizarre logic.", desc: "è¶…ç¾å¯¦ï¼šå¦‚å¤¢å¢ƒèˆ¬çš„å ´æ™¯èˆ‡å¥‡å¹»å…ƒç´ ã€‚" },
            "Logo": { spec: "Minimalist vector logo, flat icon design, isolated on white.", desc: "æ¨™èªŒè¨­è¨ˆï¼šé©åˆå‰µä½œç°¡ç´„ã€å°ˆæ¥­çš„ LOGOã€‚" },
            "Poster": { spec: "Advertising poster design, graphic layout, vibrant colors.", desc: "æµ·å ±è¨­è¨ˆï¼šå…·å‚™å¹³é¢è¨­è¨ˆæ„Ÿçš„å•†æ¥­æ’ç‰ˆã€‚" },
            "Interior": { spec: "Interior design rendering, modern architecture, soft lighting.", desc: "å®¤å…§è¨­è¨ˆï¼šç©ºé–“æ§‹åœ–èˆ‡ç¾ä»£è£ä¿®ç¾æ„Ÿã€‚" },
            "Anime": { spec: "High-quality anime art style, cel-shaded, vibrant.", desc: "å‹•æ¼«é¢¨ï¼šé«˜é£½å’Œè‰²å½©çš„ 2D å‹•æ¼«è³ªæ„Ÿã€‚" },

            // åŸå§‹ 32 é¢¨æ ¼ç²¾é¸
            "McKinsey": { spec: "Professional business framework, corporate blue.", desc: "é¡§å•é¢¨ï¼šå¼·èª¿å°ˆæ¥­é‚è¼¯èˆ‡å•†å‹™è—èª¿ã€‚" },
            "Isometric 3D": { spec: "30-degree isometric perspective, 3D cubic shapes.", desc: "ç­‰è·é¢¨ï¼šç«‹é«”æ–¹å¡Šå †ç–Šï¼Œé©åˆå‘ˆç¾æ¶æ§‹ã€‚" },
            "Claymation": { spec: "3D clay texture, visible fingerprints, handmade feel.", desc: "é»åœŸé¢¨ï¼šå¦‚å®šæ ¼å‹•ç•«èˆ¬çš„æè£½è³ªæ„Ÿã€‚" },
            "Diorama": { spec: "Miniature diorama, tilt-shift effect, tiny world.", desc: "å°å±‹é¢¨ï¼šç²¾ç·»çš„å¾®ç¸®æ™¯è§€æ¨¡å‹ã€‚" }
        };

        const ratioSpecs = {
            "1:1": { ar: "--ar 1:1", desc: "é©åˆ Instagram è²¼æ–‡ã€é ­åƒã€é›»å•†ç”¢å“åœ–ã€‚" },
            "4:5": { ar: "--ar 4:5", desc: "Instagram æœ€ä½³åŒ–å‚ç›´è²¼æ–‡ï¼Œä½”æ“šæ›´å¤šæ‰‹æ©Ÿç‰ˆé¢ã€‚" },
            "9:16": { ar: "--ar 9:16", desc: "é©ç”¨ï¼šReelsã€TikTokã€Stories æ‰‹æ©Ÿå…¨è¢å¹•é«”é©—ã€‚" },
            "16:9": { ar: "--ar 16:9", desc: "é©åˆ YouTube å½±ç‰‡ã€é›»è…¦è¢å¹•æ¡Œå¸ƒã€é›»å½±è¦–è§’ã€‚" },
            "3:2": { ar: "--ar 3:2", desc: "å°ˆæ¥­æ”å½±ç›¸ç‰‡æ²–å°å¸¸ç”¨æ¯”ä¾‹ã€‚" },
            "21:9": { ar: "--ar 21:9", desc: "è¶…å¯¬æ¯”ä¾‹ï¼Œæœ€é©åˆ Notion å°é¢èˆ‡é›»å½±æ„Ÿè¦–è¦ºã€‚" }
        };

        let selectedType = 'general';
        let selectedRatio = '9:16';
        let history = JSON.parse(localStorage.getItem('prompt_history_v65') || '[]');

        function vibrate() { if (navigator.vibrate) navigator.vibrate(15); }

        function setType(type, btn) {
            selectedType = type;
            document.querySelectorAll('.type-btn').forEach(b => {
                b.className = 'type-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all';
            });
            btn.className = 'type-btn ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/40 p-3 rounded-xl text-indigo-700 dark:text-indigo-300 text-[10px] font-bold transition-all shadow-sm';
        }

        function setRatio(ratio, btn) {
            vibrate();
            selectedRatio = ratio;
            document.querySelectorAll('.ratio-btn').forEach(b => {
                b.className = 'ratio-btn border border-gray-100 dark:border-slate-700 p-3 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all';
            });
            btn.className = 'ratio-btn ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/40 p-3 rounded-xl text-indigo-700 dark:text-indigo-300 text-[10px] font-bold transition-all shadow-sm';
            document.getElementById('arHint').innerText = "é©ç”¨ï¼š" + ratioSpecs[ratio].desc;
        }

        function randomStyleOnly() {
            vibrate();
            const icon = document.getElementById('diceIcon');
            icon.classList.add('rolling');
            setTimeout(() => icon.classList.remove('rolling'), 500);
            const styleSelect = document.getElementById('style');
            const options = Array.from(styleSelect.querySelectorAll('option')).filter(o => o.value !== "");
            styleSelect.value = options[Math.floor(Math.random() * options.length)].value;
            updatePreview();
        }

        function updatePreview() {
            const style = document.getElementById('style').value;
            const card = document.getElementById('previewCard');
            if(styleSpecs[style]) {
                document.getElementById('previewText').innerText = "ğŸ’¡ " + styleSpecs[style].desc;
                card.classList.remove('hidden');
            }
        }

        function generate() {
            const content = document.getElementById('content').value.trim() || "Amazing AI Art";
            const style = document.getElementById('style').value;
            if(!style) return alert('è«‹å…ˆé¸æ“‡é¢¨æ ¼å–”ï¼');
            
            const typeLabel = (selectedType === 'general') ? "image" : selectedType;
            const prompt = `/imagine prompt: A ${style} style ${typeLabel} about '${content}'. \n- ${styleSpecs[style].spec} \n- Aspect ratio: ${selectedRatio} ${ratioSpecs[selectedRatio].ar} --v 6.0`;
            
            document.getElementById('finalPrompt').innerText = prompt;
            document.getElementById('resultBox').classList.remove('hidden');
            saveToHistory(style, content, prompt);
        }

        function saveToHistory(s, c, p) {
            history.unshift({ style: s, content: c, prompt: p });
            if (history.length > 5) history.pop();
            localStorage.setItem('prompt_history_v65', JSON.stringify(history));
            renderHistory();
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = history.map((item, index) => `
                <div class="p-4 bg-gray-50 dark:bg-slate-900 rounded-2xl border flex justify-between items-center shadow-sm active:scale-95 transition-all" onclick="loadFromHistory(${index})">
                    <div class="overflow-hidden">
                        <p class="text-[9px] font-black text-indigo-500 uppercase">${item.style}</p>
                        <p class="text-[12px] text-gray-700 dark:text-slate-300 font-bold truncate w-48">${item.content}</p>
                    </div>
                    <i class="fas fa-magic text-[10px] text-indigo-300"></i>
                </div>`).join('');
        }

        function loadFromHistory(i) {
            vibrate();
            document.getElementById('finalPrompt').innerText = history[i].prompt;
            document.getElementById('resultBox').classList.remove('hidden');
        }

        function clearHistory() { history = []; localStorage.removeItem('prompt_history_v65'); renderHistory(); }
        function copyText() { navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText); alert('æŒ‡ä»¤å·²è¤‡è£½ï¼'); }
        function shareLine() { window.open(`https://line.me/R/msg/text/?${encodeURIComponent(document.getElementById('finalPrompt').innerText)}`); }
        function shareFB() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${window.location.href}`); }

        renderHistory();
    </script>
</body>
</html>
