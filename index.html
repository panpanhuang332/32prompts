<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MJ æç¤ºè©ç”¢ç”Ÿå™¨ (å‹•æ¼«æ“´å……ç‰ˆ)</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* --- æ ¸å¿ƒä½ˆå±€ --- */
        body { background-color: #f0f2f5; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .app-header { background: white; padding: 15px 15px 0 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); z-index: 10; flex-shrink: 0; }
        .nav-tabs { border-bottom: none; flex-wrap: nowrap; overflow-x: auto; white-space: nowrap; gap: 5px; padding-bottom: 5px; }
        .nav-tabs .nav-link { border: none; color: #6c757d; font-size: 0.95rem; padding: 8px 12px; border-radius: 20px; background-color: #f8f9fa; transition: all 0.2s; }
        .nav-tabs .nav-link.active { color: white; background-color: #0d6efd; font-weight: bold; }
        .nav-tabs .nav-link.disabled-tab { opacity: 0.5; pointer-events: none; background-color: #e9ecef; }
        
        .app-content { flex-grow: 1; overflow-y: auto; padding: 15px; background-color: #f0f2f5; scroll-behavior: smooth; }
        .tab-content-area { display: none; animation: fadeIn 0.3s; }
        .tab-content-area.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .category-card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); transition: opacity 0.3s; }
        .category-card.disabled-card { opacity: 0.5; pointer-events: none; filter: grayscale(100%); }

        .category-title { font-size: 0.9rem; font-weight: bold; color: #343a40; margin-bottom: 8px; display: block; border-left: 4px solid #0d6efd; padding-left: 8px; }
        .app-footer { background: white; padding: 10px 15px; border-top: 1px solid #dee2e6; flex-shrink: 0; z-index: 20; padding-bottom: max(10px, env(safe-area-inset-bottom)); }
        
        .loading-text { font-size: 0.8em; color: #0d6efd; margin-top: 5px; display: none; }
        .form-select { background-color: #f8f9fa; border: 1px solid #e9ecef; }
        .form-select:disabled { background-color: #e9ecef; color: #adb5bd; cursor: not-allowed; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        
        .locked-badge { display: none; font-size: 0.7rem; background: #dc3545; color: white; padding: 2px 6px; border-radius: 4px; margin-left: 5px; }
    </style>
</head>
<body>

    <div class="app-header">
        <h6 class="mb-2 fw-bold text-dark">ğŸ¨ MJ æç¤ºè©ç”¢ç”Ÿå™¨ (Anime+)</h6>
        
        <div class="mb-2">
            <div class="input-group">
                <input type="text" class="form-control" id="mainSubject" placeholder="æè¿°ç•«é¢ä¸»é«” (æ”¯æ´ä¸­æ–‡)...">
                <button class="btn btn-outline-primary" type="button" id="translateBtn" onclick="translateInput()">
                    ä¸­ç¿»è‹±
                </button>
            </div>
            <div id="translationStatus" class="loading-text">æ­£åœ¨ç¿»è­¯ä¸­...</div>
        </div>

        <div class="nav nav-tabs" id="myTab" role="tablist">
            <button class="nav-link active" id="btn-settings" onclick="switchTab(this, 'page-settings')">âš™ï¸ è¨­å®š</button>
            <button class="nav-link" id="btn-photo" onclick="switchTab(this, 'page-photo')">ğŸ“¸ æ”å½±</button>
            <button class="nav-link" id="btn-art" onclick="switchTab(this, 'page-art')">ğŸ–Œï¸ è—è¡“ <span class="locked-badge">é–å®š</span></button>
            <button class="nav-link" id="btn-anime" onclick="switchTab(this, 'page-anime')">ğŸ§¸ å‹•æ¼« <span class="locked-badge">é–å®š</span></button>
        </div>
    </div>

    <div class="app-content">
        
        <div id="page-settings" class="tab-content-area active">
            <div class="category-card">
                <label class="category-title">ğŸ“ åœ–ç‰‡æ¯”ä¾‹ (Aspect Ratio)</label>
                <select class="form-select" id="aspectRatio">
                    <option value="" selected>1:1 (é è¨­æ­£æ–¹å½¢)</option>
                    <optgroup label="æ©«å‘">
                        <option value="--ar 16:9">16:9 (å¯¬è¢å¹•/YT)</option>
                        <option value="--ar 21:9">21:9 (Notionå°é¢)</option>
                        <option value="--ar 4:3">4:3 (æ¨™æº–ç…§ç‰‡)</option>
                        <option value="--ar 3:2">3:2 (åº•ç‰‡)</option>
                    </optgroup>
                    <optgroup label="ç›´å‘">
                        <option value="--ar 4:5">4:5 (IG è²¼æ–‡)</option>
                        <option value="--ar 3:4">3:4 (ç›´å¼ç…§ç‰‡)</option>
                        <option value="--ar 9:16">9:16 (é™å‹•/Reels)</option>
                    </optgroup>
                </select>
            </div>

            <div class="category-card">
                <label class="category-title">ğŸ’ è§£æåº¦ (Resolution)</label>
                <select class="form-select" id="pixelResolution">
                    <option value="" selected>é è¨­</option>
                    <optgroup label="ç¤¾ç¾¤/è¢å¹•">
                        <option value="1080x1080 px, high quality">IG æ­£æ–¹å½¢ (1080p)</option>
                        <option value="1080x1920 px, full screen">IG é™å‹• (Full HD)</option>
                        <option value="3840x2160 px, 4K UHD">4K è¶…é«˜ç•«è³ª</option>
                    </optgroup>
                    <optgroup label="å°åˆ·/æ”å½±">
                        <option value="2480x3508 px, 300DPI">A4 å°åˆ·è¦æ ¼</option>
                        <option value="6000x4000 px, 24MP">2400 è¬åƒç´ </option>
                    </optgroup>
                </select>
            </div>
            
            <div class="text-center text-muted small mt-4 p-3">
                <p>ğŸ’¡ æç¤ºï¼š<br>è‹¥é¸æ“‡äº†ã€Œæ”å½±é¡å‹ã€ï¼Œ<br>è—è¡“èˆ‡å‹•æ¼«é¸é …å°‡æœƒè‡ªå‹•é–å®šã€‚</p>
            </div>
        </div>

        <div id="page-photo" class="tab-content-area">
            <div id="container-photo"></div>
        </div>

        <div id="page-art" class="tab-content-area">
            <div id="container-art"></div>
        </div>

        <div id="page-anime" class="tab-content-area">
            <div id="container-anime"></div>
        </div>

    </div>

    <div class="app-footer">
        <div class="d-grid gap-2 mb-2">
            <button class="btn btn-primary fw-bold" onclick="generatePrompt()">
                âœ¨ ç”¢å‡ºæç¤ºè©
            </button>
        </div>
        <div class="input-group input-group-sm">
            <textarea class="form-control" id="outputPrompt" rows="1" readonly placeholder="æç¤ºè©å°‡é¡¯ç¤ºæ–¼æ­¤" style="resize: none;"></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">è¤‡è£½</button>
        </div>
    </div>

<script>
    // --- 1. åˆ†é åˆ‡æ›é‚è¼¯ ---
    function switchTab(btn, targetId) {
        if (btn.classList.contains('disabled-tab')) return;

        document.querySelectorAll('.nav-link').forEach(b => {
            b.classList.remove('active');
            b.style.backgroundColor = '#f8f9fa';
            b.style.color = '#6c757d';
        });
        btn.classList.add('active');
        btn.style.backgroundColor = '#0d6efd';
        btn.style.color = 'white';

        document.querySelectorAll('.tab-content-area').forEach(div => div.classList.remove('active'));
        const targetDiv = document.getElementById(targetId);
        if (targetDiv) targetDiv.classList.add('active');
    }

    // --- 2. è³‡æ–™åº« ---
    const categorizedData = {
        "photo": { 
            "æ”å½±é¡å‹ (Types)": [
                { id: "photo_type", val: "photo", label: "ç…§ç‰‡ (photo)"}, 
                { id: "photo_type", val: "photography", label: "æ”å½± (photography)"},
                { id: "photo_type", val: "life photo", label: "ç”Ÿæ´»ç…§ (life photo)"}, 
                { id: "photo_type", val: "group photo", label: "åœ˜é«”ç…§ (group photo)"},
                { id: "photo_type", val: "selfie photo", label: "è‡ªæ‹ç…§ (selfie photo)"}, 
                { id: "photo_type", val: "portrait photography", label: "äººåƒæ”å½± (portrait)"}, 
                { id: "photo_type", val: "sports photography", label: "é‹å‹•æ”å½± (sports)"},
                { id: "photo_type", val: "still life photo", label: "éœç‰©æ”å½± (still life)"}
            ],
            "å…‰åœˆ (Aperture)": [
                { id: "photo_aperture", val: "f/1", label: "f/1 (è¶…å¤§å…‰åœˆ)"}, { id: "photo_aperture", val: "f/1.4", label: "f/1.4"},
                { id: "photo_aperture", val: "f/2", label: "f/2"}, { id: "photo_aperture", val: "f/2.8", label: "f/2.8"},
                { id: "photo_aperture", val: "f/4", label: "f/4"}, { id: "photo_aperture", val: "f/5.6", label: "f/5.6"},
                { id: "photo_aperture", val: "f/8", label: "f/8 (æ¨™æº–é¢¨æ™¯)"}, { id: "photo_aperture", val: "f/11", label: "f/11"},
                { id: "photo_aperture", val: "f/16", label: "f/16"}, { id: "photo_aperture", val: "f/22", label: "f/22"},
                { id: "photo_aperture", val: "f/32", label: "f/32 (æ·±æ™¯æ·±)"}
            ],
            "ç„¦è· (Focal Length)": [
                { id: "photo_focal", val: "20mm", label: "20mm (è¶…å»£è§’)"}, { id: "photo_focal", val: "24mm", label: "24mm (å»£è§’)"},
                { id: "photo_focal", val: "28mm", label: "28mm"}, { id: "photo_focal", val: "35mm", label: "35mm (äººæ–‡)"},
                { id: "photo_focal", val: "85mm", label: "85mm (äººåƒ)"}, { id: "photo_focal", val: "105mm", label: "105mm"},
                { id: "photo_focal", val: "200mm", label: "200mm (æœ›é )"}, { id: "photo_focal", val: "300mm", label: "300mm"},
                { id: "photo_focal", val: "400mm", label: "400mm"}, { id: "photo_focal", val: "600mm", label: "600mm (è¶…æœ›é )"}
            ],
            "ç’°å¢ƒèˆ‡ç•«è³ªè¼”åŠ© (Auxiliary)": [
                { val: "bright", label: "ç’°å¢ƒè¼ƒæ˜äº® (bright)"}, { val: "dark", label: "ç’°å¢ƒè¼ƒæš— (dark)"},
                { val: "realistic", label: "é€¼çœŸçš„ (realistic)"}, { val: "b/w", label: "é»‘ç™½ç…§ç‰‡ (b/w)"},
                { val: "very realistic", label: "éå¸¸é€¼çœŸçš„ (å¼·èª¿ç´‹ç†)"}, { val: "very detailed", label: "éå¸¸å¤šç´°ç¯€ (å¢åŠ ç‰©ä»¶)"},
                { val: "high resolution", label: "é«˜åˆ†è¾¨ç‡"}, { val: "8K", label: "8K ç•«è³ª"}
            ],
            "æ”å½±é¢¨æ ¼ (Styles)": [
                {val: "DSLR style", label: "æ•¸ä½å–®çœ¼"}, {val: "Polaroid style", label: "æ‹ç«‹å¾—"},
                {val: "gopro style", label: "GoPro"}, {val: "Fujifilm superia style", label: "å¯Œå£«åº•ç‰‡"},
                {val: "LOMO style", label: "LOMO"}, {val: "movie style", label: "é›»å½±é¢¨"},
                {val: "cinematic photo style", label: "åŠ‡ç…§"}, {val: "vintage photo style", label: "å¾©å¤"},
                {val: "antique photo style", label: "ä»¿å¤"}, {val: "Calotype print", label: "ç´™åŸºè² ç‰‡"},
                {val: "Holga photography", label: "Holga ç›¸æ©Ÿ"}, {val: "Anthotype print", label: "æ¤ç‰©æ„Ÿå…‰"}
            ],
            "é¡é ­èˆ‡å…‰å½± (Lens/Light)": [
                {val: "macro lens", label: "å¾®è·é¡é ­"}, {val: "prime lens", label: "å®šç„¦é¡é ­"},
                {val: "wide angle lens", label: "å»£è§’é¡é ­"}, {val: "fish eye lens", label: "é­šçœ¼é¡é ­"},
                {val: "tilt shift lens", label: "ç§»è»¸é¡é ­"}, {val: "long focal length lens", label: "æœ›é é¡é ­"},
                {val: "bokeh", label: "æ•£æ™¯/æ™¯æ·±"}, {val: "lens flare", label: "é¡é ­çœ©å…‰"},
                {val: "magic hour", label: "é­”å¹»æ™‚åˆ»"}, {val: "golden hour", label: "é»ƒé‡‘æ™‚åˆ»"},
                {val: "blue hour", label: "è—è‰²æ™‚åˆ»"}, {val: "ambient light", label: "ç’°å¢ƒå…‰"},
                {val: "hard light", label: "ç¡¬å…‰"}, {val: "soft light", label: "æŸ”å…‰"},
                {val: "back light", label: "èƒŒå…‰"}, {val: "rim light", label: "è¼ªå»“å…‰"},
                {val: "multiple exposure", label: "é‡è¤‡æ›å…‰"}, {val: "motion blur", label: "å‹•æ…‹æ¨¡ç³Š"},
                {val: "HDR", label: "HDR"}
            ],
            "ç•«é¢è§’åº¦ (Angles)": [
                {val: "face close-up", label: "è‡‰éƒ¨ç‰¹å¯«"}, {val: "full body shot", label: "å…¨èº«ç…§"},
                {val: "front view", label: "æ­£é¢ç…§"}, {val: "side view", label: "å´é¢ç…§"},
                {val: "low angle view", label: "ä½è§’åº¦"}, {val: "high angle view", label: "é«˜è§’åº¦"},
                {val: "bird view", label: "é³¥ç°"}, {val: "satellite view", label: "è¡›æ˜Ÿè¦–è§’"},
                {val: "the first person view", label: "ç¬¬ä¸€äººç¨±"}, {val: "knolling", label: "é–‹ç®±ç…§"},
                {val: "product view", label: "ç”¢å“ç‰¹å¯«"}, {val: "microscope view", label: "é¡¯å¾®é¡è¦–è§’"},
                {val: "360 degrees photo", label: "360åº¦ç…§ç‰‡"}
            ]
        },
        "art": { 
            "ç¹ªç•«åª’æ (Mediums)": [
                {val: "illustration", label: "æ’ç•«"}, {val: "pencil", label: "é‰›ç­†ç•«"},
                {val: "charcoal", label: "ç‚­ç­†ç•«"}, {val: "color pencil", label: "è‰²é‰›ç­†"},
                {val: "acrylic painting", label: "å£“å…‹åŠ›ç•«"}, {val: "watercolor painting", label: "æ°´å½©ç•«"},
                {val: "oil painting", label: "æ²¹ç•«"}, {val: "ink drawing", label: "æ°´å¢¨ç•«"},
                {val: "Woodcut", label: "æœ¨åˆ»ç‰ˆç•«"}, {val: "vector art", label: "å‘é‡åœ–"}
            ],
            "ç‰¹æ®Šæè³ª (Materials)": [
                {val: "paper art", label: "ç´™é›•"}, {val: "pop-up book", label: "ç«‹é«”æ›¸"},
                {val: "origami art", label: "æ‘ºç´™"}, {val: "stained glass", label: "å½©ç¹ªç»ç’ƒ"},
                {val: "pixel art", label: "åƒç´ ç•«"}, {val: "Low poly", label: "ä½å¤šé‚Šå½¢"},
                {val: "wood carving", label: "æœ¨é›•"}, {val: "stone carving", label: "çŸ³é›•"},
                {val: "lego", label: "æ¨‚é«˜"}, {val: "felt doll", label: "ç¾Šæ¯›æ°ˆ"},
                {val: "neon light", label: "éœ“è™¹ç‡ˆ"}, {val: "ASCII art", label: "ASCII ä»£ç¢¼"}
            ],
            "è—è¡“æµæ´¾ (Movements)": [
                {val: "Impressionnisme", label: "å°è±¡æ´¾"}, {val: "Surrealism", label: "è¶…ç¾å¯¦ä¸»ç¾©"},
                {val: "Cubism", label: "ç«‹é«”ä¸»ç¾©"}, {val: "Pop Art", label: "æ™®æ™®è—è¡“"},
                {val: "Minimalism", label: "æ¥µç°¡ä¸»ç¾©"}, {val: "Cyber Art", label: "è³½åšè—è¡“"},
                {val: "Steampunk", label: "è’¸æ°£é¾å…‹"}, {val: "Ukiyo-e", label: "æµ®ä¸–ç¹ª"}
            ],
            "è—è¡“å®¶ (Artists)": [
                {val: "Vincent van Gogh", label: "æ¢µè°·"}, {val: "Leonardo da Vinci", label: "é”æ–‡è¥¿"},
                {val: "Picasso", label: "ç•¢å¡ç´¢"}, {val: "Dali", label: "é”åˆ©"},
                {val: "Monet", label: "è«å…§"}, {val: "Mucha", label: "æ…•å¤"},
                {val: "Andy Warhol", label: "å®‰è¿ªæ²ƒè·"}, {val: "Hayao Miyazaki", label: "å®®å´é§¿"},
                {val: "Makoto Shinkai", label: "æ–°æµ·èª "}
            ]
        },
        "anime": { 
            "å‹•æ¼«é¡å‹ (Types)": [
                {val: "2D cartoon", label: "2D å¡é€š"}, {val: "3D cartoon", label: "3D å¡é€š"},
                {val: "Anime style", label: "æ—¥ç³»å‹•ç•«"}, {val: "American comic book", label: "ç¾å¼æ¼«ç•«"}
            ],
            "å‹•ç•«å…¬å¸ (Studios)": [
                {val: "Pixar Animation", label: "çš®å…‹æ–¯"}, {val: "DreamWorks Animation", label: "å¤¢å·¥å» "},
                {val: "Disney Animation", label: "è¿ªå£«å°¼"}, {val: "Ghibli Studio", label: "å‰åœåŠ›"},
                {val: "Kyoto Animation", label: "äº¬éƒ½å‹•ç•«"}, {val: "Marvel Animation", label: "æ¼«å¨"}
            ],
            "å‹•æ¼«ä½œå“ (Series)": [
                {val: "One Piece", label: "èˆªæµ·ç‹ (One Piece)"}, 
                {val: "Detective Conan", label: "ååµæ¢æŸ¯å— (Detective Conan)"},
                {val: "Naruto", label: "ç«å½±å¿è€… (Naruto)"},
                {val: "Slam Dunk", label: "çŒç±ƒé«˜æ‰‹ (Slam Dunk)"},
                {val: "style of Mitsuru Adachi", label: "å®‰é”å……é¢¨æ ¼ (Adachi Mitsuru)"},
                {val: "Fist of the North Star", label: "åŒ—æ–—ç¥æ‹³ (Fist of the North Star)"},
                {val: "Saint Seiya", label: "è–é¬¥å£«æ˜ŸçŸ¢ (Saint Seiya)"},
                {val: "A Certain Scientific Railgun", label: "æŸç§‘å­¸çš„è¶…é›»ç£ç ² (Scientific Railgun)"},
                {val: "SpongeBob", label: "æµ·ç¶¿å¯¶å¯¶"}, 
                {val: "Mickey Mouse", label: "ç±³è€é¼ "},
                {val: "The Simpsons", label: "è¾›æ™®æ£®å®¶æ—"}, 
                {val: "Dragon ball", label: "ä¸ƒé¾ç "},
                {val: "Doraemon", label: "å“†å•¦Aå¤¢"}, 
                {val: "Sailor Moon", label: "ç¾å°‘å¥³æˆ°å£«"},
                {val: "kimetsu no Yaiba", label: "é¬¼æ»…ä¹‹åˆƒ"}, 
                {val: "JoJo", label: "JoJo"}
            ],
            "è¨­è¨ˆèˆ‡çµæ§‹ (Design)": [
                {val: "mascot logo", label: "å‰ç¥¥ç‰© Logo"}, {val: "UI design", label: "UI ä»‹é¢"},
                {val: "3D Model Exploded View", label: "3D åˆ†è§£åœ–"}, {val: "2D floor plan", label: "2D å¹³é¢åœ–"},
                {val: "character toy", label: "å…¬ä»”ç©å…·"}
            ]
        }
    };

    // --- 3. åˆå§‹åŒ–ä»‹é¢èˆ‡é‚è¼¯ ---
    function init() {
        for (const [tabKey, categories] of Object.entries(categorizedData)) {
            const container = document.getElementById(`container-${tabKey}`);
            if (!container) continue;
            
            for (const [catName, items] of Object.entries(categories)) {
                const card = document.createElement('div');
                card.className = 'category-card';
                
                const label = document.createElement('label');
                label.className = 'category-title';
                label.textContent = catName;
                card.appendChild(label);
                
                const select = document.createElement('select');
                select.className = 'form-select category-select';
                
                if (items.length > 0 && items[0].id) {
                    select.id = items[0].id;
                }
                
                const defaultOpt = document.createElement('option');
                defaultOpt.value = "";
                defaultOpt.textContent = "ä¸æŒ‡å®š";
                select.appendChild(defaultOpt);
                
                items.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.val;
                    opt.textContent = item.label;
                    select.appendChild(opt);
                });
                
                card.appendChild(select);
                container.appendChild(card);
            }
        }
        
        // --- ç¶å®šæ’ä»–é‚è¼¯ ---
        const photoTypeSelect = document.getElementById('photo_type');
        const apertureSelect = document.getElementById('photo_aperture');
        const focalSelect = document.getElementById('photo_focal');
        
        if(apertureSelect) apertureSelect.disabled = true;
        if(focalSelect) focalSelect.disabled = true;

        if (photoTypeSelect) {
            photoTypeSelect.addEventListener('change', function() {
                const isPhotoSelected = this.value !== "";
                
                if(apertureSelect) {
                    apertureSelect.disabled = !isPhotoSelected;
                    if(!isPhotoSelected) apertureSelect.value = "";
                }
                if(focalSelect) {
                    focalSelect.disabled = !isPhotoSelected;
                    if(!isPhotoSelected) focalSelect.value = "";
                }

                toggleTabLock('container-art', 'btn-art', isPhotoSelected);
                toggleTabLock('container-anime', 'btn-anime', isPhotoSelected);
            });
        }
    }

    function toggleTabLock(containerId, btnId, shouldLock) {
        const container = document.getElementById(containerId);
        const btn = document.getElementById(btnId);
        
        const selects = container.querySelectorAll('select');
        selects.forEach(s => {
            s.disabled = shouldLock;
            if(shouldLock) s.value = ""; 
        });

        if (shouldLock) {
            btn.classList.add('disabled-tab');
            container.querySelectorAll('.category-card').forEach(c => c.classList.add('disabled-card'));
            btn.querySelector('.locked-badge').style.display = 'inline-block';
        } else {
            btn.classList.remove('disabled-tab');
            container.querySelectorAll('.category-card').forEach(c => c.classList.remove('disabled-card'));
            btn.querySelector('.locked-badge').style.display = 'none';
        }
    }

    // --- 4. ç¿»è­¯èˆ‡ç”¢å‡º ---
    async function translateInput() {
        const inputEl = document.getElementById('mainSubject');
        const statusEl = document.getElementById('translationStatus');
        const text = inputEl.value.trim();
        if (!text) return;
        if (!/[\u4e00-\u9fa5]/.test(text)) return text;

        statusEl.style.display = 'block';
        document.getElementById('translateBtn').disabled = true;

        try {
            const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=zh-TW|en`);
            const data = await response.json();
            if (data.responseData?.translatedText) {
                inputEl.value = data.responseData.translatedText;
                statusEl.style.display = 'none';
                return data.responseData.translatedText;
            }
        } catch (e) { console.error(e); } 
        finally { 
            document.getElementById('translateBtn').disabled = false;
            statusEl.style.display = 'none';
        }
    }

    async function generatePrompt() {
        let mainSubject = document.getElementById('mainSubject').value.trim();
        const aspectRatio = document.getElementById('aspectRatio').value;
        const pixelRes = document.getElementById('pixelResolution').value;
        const btn = document.querySelector('.btn-primary');

        if (/[\u4e00-\u9fa5]/.test(mainSubject)) {
            const originalText = btn.textContent;
            btn.textContent = "â³ ç¿»è­¯ä¸­...";
            btn.disabled = true;
            mainSubject = await translateInput() || mainSubject;
            btn.textContent = originalText;
            btn.disabled = false;
        }

        let parts = [];
        if (mainSubject) parts.push(mainSubject);
        if (pixelRes) parts.push(pixelRes);

        document.querySelectorAll('.category-select').forEach(select => {
            if (select.value && !select.disabled) {
                parts.push(select.value);
            }
        });

        parts.push("--v 6.0");
        if (aspectRatio) parts.push(aspectRatio);

        document.getElementById('outputPrompt').value = parts.join(', ');
    }

    function copyToClipboard() {
        const el = document.getElementById("outputPrompt");
        el.select();
        el.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(el.value);
    }

    init();

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
</script>
</body>
</html>
