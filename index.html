<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Inspiration Lab - V8.0 UI Upgrade</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>tailwind.config = { darkMode: 'media' }</script>
    <style>
        /* å…¨å±€èƒŒæ™¯èˆ‡è³ªæ„Ÿ */
        body {
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(135deg, #f0f4ff 0%, #e5e7eb 100%);
            transition: background-color 0.4s ease;
        }
        @media (prefers-color-scheme: dark) {
            body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        }

        /* ä¸»å¡ç‰‡æ¨£å¼å„ªåŒ– */
        .app-card {
            border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }
        @media (prefers-color-scheme: dark) {
            .app-card { border-color: rgba(255, 255, 255, 0.1); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        }

        /* Header æ¼¸å±¤èˆ‡ç´‹ç† */
        .gradient-header {
            background: linear-gradient(120deg, #4f46e5, #8b5cf6, #ec4899);
            background-size: 200% 200%;
            animation: gradientBG 6s ease infinite;
        }
        @keyframes gradientBG { 0% {background-position: 0% 50%;} 50% {background-position: 100% 50%;} 100% {background-position: 0% 50%;} }

        /* è¼¸å…¥æ¡†èˆ‡é¸å–®ç¾åŒ– */
        .input-premium {
            border: 2px solid transparent;
            background-color: #f8fafc;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
        }
        .input-premium:focus {
            border-color: #8b5cf6;
            background-color: #fff;
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
        }
        @media (prefers-color-scheme: dark) {
            .input-premium { background-color: #1e293b; color: #e2e8f0; box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.2); }
            .input-premium:focus { background-color: #0f172a; }
        }

        /* æŒ‰éˆ•ç¾åŒ– */
        .btn-generate {
            background: linear-gradient(135deg, #6366f1, #a855f7);
            box-shadow: 0 10px 20px -10px rgba(99, 102, 241, 0.5);
        }
        .btn-generate:hover { box-shadow: 0 15px 30px -5px rgba(99, 102, 241, 0.6); transform: translateY(-2px); }
        .btn-generate:active { transform: translateY(1px); box-shadow: 0 5px 10px -5px rgba(99, 102, 241, 0.4); }

        /* é¸å–®ç®­é ­èˆ‡ç¦ç”¨ç‹€æ…‹ */
        select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23a855f7' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 1.2rem center; background-repeat: no-repeat; background-size: 1.2em; }
        select:disabled { opacity: 0.5; cursor: not-allowed; background-color: #f1f5f9; color: #94a3b8; border-color: transparent; }
        @media (prefers-color-scheme: dark) { select:disabled { background-color: #334155; color: #64748b; } }

        /* éª°å­å‹•ç•« */
        @keyframes dice-roll { 0% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1); } }
        .rolling { animation: dice-roll 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
    </style>
</head>
<body class="p-4 min-h-screen font-sans pb-10 flex justify-center items-start py-8">

    <div class="w-full max-w-md bg-white dark:bg-slate-800 app-card overflow-hidden relative">
        <div class="p-10 gradient-header text-white relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none" style="background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.8) 1px, transparent 0); background-size: 24px 24px;"></div>
            
            <div class="relative z-10">
                <h1 class="text-3xl font-black italic flex items-center gap-3 tracking-wider">
                    <i class="fas fa-wand-magic-sparkles text-yellow-300"></i> AI éˆæ„Ÿå¯¦é©—å®¤
                </h1>
                <p class="text-purple-100 text-[11px] mt-3 font-bold tracking-[0.3em] opacity-90 uppercase">æ——è‰¦ç´šå‰µä½œå¼•æ“ V8.0</p>
            </div>
            
            <button onclick="randomStyleOnly()" class="absolute bottom-8 right-8 bg-white/20 hover:bg-white/30 backdrop-blur-md p-3.5 rounded-2xl border border-white/40 transition-all active:scale-90 group shadow-lg glow-effect">
                <i id="diceIcon" class="fas fa-dice text-2xl text-white drop-shadow-sm"></i>
            </button>
        </div>

        <div class="p-8 space-y-9">
            <section>
                <label class="text-xs font-black text-purple-600 dark:text-purple-400 mb-4 block tracking-[0.2em] uppercase pl-1">Step 01. åœ–ç‰‡é¡å‹</label>
                <div class="grid grid-cols-3 gap-3">
                    <button id="type-general" onclick="vibrate(); setType('general', this)" class="type-btn ring-2 ring-purple-500 bg-purple-50 dark:bg-purple-900/30 p-3 rounded-2xl text-purple-700 dark:text-purple-300 text-[11px] font-bold transition-all shadow-sm">é€šç”¨åœ–åƒ</button>
                    <button id="type-infographic" onclick="vibrate(); setType('infographic', this)" class="type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800">è³‡è¨Šåœ–è¡¨</button>
                    <button id="type-diagram" onclick="vibrate(); setType('diagram', this)" class="type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800">åŠŸèƒ½åœ–è§£</button>
                    <button id="type-flowchart" onclick="vibrate(); setType('flowchart', this)" class="type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800">æµç¨‹åœ–</button>
                    <button id="type-portrait" onclick="vibrate(); setType('portrait', this)" class="type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800">äººåƒæ”å½±</button>
                    <button id="type-landscape" onclick="vibrate(); setType('landscape', this)" class="type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800">å£¯é—Šé¢¨æ™¯</button>
                </div>
            </section>

            <section>
                <label class="text-xs font-black text-purple-600 dark:text-purple-400 mb-4 block tracking-[0.2em] uppercase pl-1">Step 02. å…§å®¹ä¸»é¡Œ</label>
                <textarea id="content" rows="2" placeholder="ä½ æƒ³å‘ˆç¾ä»€éº¼ç•«é¢å…§å®¹ï¼Ÿ" class="input-premium w-full p-4 rounded-2xl outline-none text-gray-700 text-sm transition-all"></textarea>
            </section>

            <section class="space-y-4">
                <label class="text-xs font-black text-purple-600 dark:text-purple-400 block tracking-[0.2em] uppercase pl-1">Step 03. è¦–è¦ºé¢¨æ ¼èˆ‡é€²éšåƒæ•¸</label>
                
                <select id="styleCategory" onchange="vibrate(); updateTieredUI()" class="input-premium w-full p-4 rounded-2xl font-black text-purple-600 dark:text-purple-400 outline-none text-sm">
                    <option value="" disabled selected>1. é¸æ“‡é¢¨æ ¼åˆ†é¡...</option>
                    <option id="opt-pro-photo" value="ProPhotography">ğŸ“¸ å°ˆæ¥­æ”å½±èˆ‡åƒæ•¸ (å¯å•Ÿç”¨è¼”åŠ©)</option>
                    <option value="Photography">ğŸ“· ä¸€èˆ¬æ”å½±èˆ‡ç…§ç‰‡é¢¨æ ¼</option>
                    <option value="Painting">ğŸ–Œï¸ ç¹ªç•«åª’æèˆ‡è³ªæ„Ÿ</option>
                    <option value="ArtMovements">ğŸ›ï¸ è—è¡“æµæ´¾èˆ‡é¢¨æ ¼</option>
                    <option value="FamousArtists">ğŸ¨ çŸ¥åè—è¡“å®¶å¤§å¸«</option>
                    <option value="AnimeComics">ğŸ¬ å‹•ç•«èˆ‡æ¼«æ™</option>
                    <option value="DesignSpecial">âœ¨ ç‰¹æ®Šèˆ‡è¨­è¨ˆé¢¨æ ¼</option>
                    <option value="BusinessPro">ğŸ’¼ å°ˆæ¥­å•†å‹™æ‡‰ç”¨</option>
                </select>

                <select id="styleDetail" onchange="vibrate(); updatePreview()" class="input-premium w-full p-4 rounded-2xl font-bold text-gray-700 outline-none text-sm" disabled>
                    <option value="">2. å†é¸æ“‡å…·é«”é¢¨æ ¼...</option>
                </select>

                <select id="proAssist" onchange="vibrate(); updatePreview()" class="input-premium w-full p-4 rounded-2xl font-bold text-gray-700 outline-none text-sm" disabled>
                    <option value="" selected>3. å°ˆæ¥­æ”å½±è¼”åŠ©æè¿° (é–å®šä¸­)...</option>
                    <option value="bright">ç’°å¢ƒè¼ƒæ˜äº® Bright</option>
                    <option value="dark">ç’°å¢ƒè¼ƒæš— Dark</option>
                    <option value="realistic">é€¼çœŸçš„ Realistic</option>
                    <option value="b/w">é»‘ç™½ç…§ç‰‡ B/W</option>
                    <option value="very realistic">éå¸¸é€¼çœŸçš„ (å¼·èª¿ç´‹ç†)</option>
                    <option value="very detailed">è±å¯Œç´°ç¯€ (å¢åŠ ç‰©ä»¶)</option>
                    <option value="high resolution">é«˜åˆ†è¾¨ç‡ Resolution</option>
                    <option value="8K">8K é ‚ç´šç•«è³ª 8K</option>
                </select>

                <div id="previewCard" class="hidden p-4 rounded-2xl bg-purple-50 dark:bg-slate-900/50 border-2 border-purple-100 dark:border-purple-900/30 animate-in fade-in">
                    <p id="previewText" class="text-xs text-purple-700 dark:text-purple-300 leading-relaxed font-bold"></p>
                </div>
            </section>

            <section class="space-y-4">
                <label class="text-xs font-black text-purple-600 dark:text-purple-400 block tracking-[0.2em] uppercase pl-1">Step 04. é•·å¯¬æ¯”ä¾‹</label>
                <select id="ratioSelect" onchange="vibrate(); handleRatioChange()" class="input-premium w-full p-4 rounded-2xl font-bold text-gray-700 outline-none text-sm">
                    <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                    <option value="4:5">4:5 (IG å‚ç›´)</option>
                    <option value="9:16" selected>9:16 (æ‰‹æ©Ÿå…¨è¢å¹•)</option>
                    <option value="16:9">16:9 (é›»è…¦/å½±ç‰‡)</option>
                    <option value="3:2">3:2 (å°ˆæ¥­æ”å½±)</option>
                    <option value="21:9">21:9 (Notion å°é¢)</option>
                    <option value="custom">âœï¸ è‡ªè¨‚æ¯”ä¾‹ (Custom)</option>
                </select>
                <div id="customRatioBox" class="hidden animate-in slide-in-from-top-2">
                    <input type="text" id="customRatioInput" placeholder="ä¾‹å¦‚ 2.35:1" class="input-premium w-full p-4 rounded-2xl text-sm font-mono outline-none text-purple-600">
                </div>
            </section>

            <button onclick="vibrate(); generate()" class="btn-generate w-full text-white font-black py-5 rounded-[20px] text-lg transition-all flex justify-center items-center gap-3 tracking-wider">
                ç”Ÿæˆå¤§å¸«æŒ‡ä»¤ <i class="fas fa-wand-magic-sparkles"></i>
            </button>

            <div id="resultBox" class="hidden animate-in zoom-in-95 duration-300 pb-2">
                <div class="bg-slate-900 rounded-[2.5rem] p-8 border-2 border-slate-700/50 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-purple-500/10 to-blue-500/10 pointer-events-none"></div>
                    
                    <p id="finalPrompt" class="text-purple-200 text-xs font-mono whitespace-pre-line leading-relaxed bg-slate-950/80 p-6 rounded-3xl border border-white/10 shadow-inner mb-7 relative z-10 select-all"></p>
                    <div class="grid grid-cols-3 gap-3 relative z-10">
                        <button onclick="vibrate(); copyText()" class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-2xl flex items-center justify-center transition-colors shadow-lg shadow-purple-500/20"><i class="far fa-copy text-lg"></i></button>
                        <button onclick="vibrate(); shareLine()" class="bg-[#06C755] hover:bg-[#05b34c] text-white p-4 rounded-2xl flex items-center justify-center transition-colors shadow-lg shadow-green-500/20"><i class="fab fa-line text-xl"></i></button>
                        <button onclick="vibrate(); shareFB()" class="bg-[#1877F2] hover:bg-[#166fe5] text-white p-4 rounded-2xl flex items-center justify-center transition-colors shadow-lg shadow-blue-500/20"><i class="fab fa-facebook text-xl"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- V7.8 å®Œæ•´åŠŸèƒ½é‚è¼¯ä¿æŒä¸è®Š ---
        const styleDisplayNames = {
            "macro lens": "å¾®è·é¡é ­ Macro", "prime lens": "å®šç„¦é¡é ­ Prime", "long focal length lens": "æœ›é é¡é ­ Tele", "wide angle lens": "å»£è§’é¡é ­ Wide", "fish eye lens": "é­šçœ¼é¡é ­ Fish-eye", "tilt shift lens": "ç§»è»¸é¡é ­ Tilt-shift", "bokeh": "æ•£æ™¯æ•ˆæœ Bokeh", "magic hour": "é­”å¹»æ™‚åˆ» Magic Hour", "golden hour": "é»ƒé‡‘æ™‚åˆ» Golden Hour", "blue hour": "è—è‰²æ™‚åˆ» Blue Hour", "lens flare": "é¡é ­çœ©å…‰ Flare", "multiple exposure": "é‡è¤‡æ›å…‰ Exposure", "panning": "å¹³ç§»æ‹æ” Panning", "motion blur": "å‹•æ…‹æ¨¡ç³Š Motion", "vgnetting": "æšˆå½±æš—è§’ Vignette", "ambient light": "ç’°å¢ƒå…‰ Ambient", "hard light": "ç¡¬å…‰ Hard", "soft light": "æŸ”å…‰ Soft", "back light": "é€†å…‰ Backlight", "rim light": "è¼ªå»“å…‰ Rim", "HDR": "é«˜å‹•æ…‹ç¯„åœ HDR", "4K HDR": "æ¥µè‡´ 4K HDR",
            "Photo": "æ¨™æº–ç…§ç‰‡ Photo", "life photo": "ç”Ÿæ´»ç…§ Life", "group photo": "åœ˜é«”ç…§ Group", "group selfie photo": "è‡ªæ‹åœ˜é«” Group Selfie", "selfie photo": "å€‹äººè‡ªæ‹ Selfie", "portrait photography": "äººåƒæ”å½± Portrait", "ports photography": "é‹å‹•æ”å½± Sports", "still life photo": "éœç‰©æ”å½± Still Life", "DSLR style": "å–®çœ¼é¢¨æ ¼ DSLR", "Polaroid style": "æ‹ç«‹å¾— Polaroid", "Fujifilm": "å¯Œå£«åº•ç‰‡ Fujifilm", "LOMO style": "LOMO ç›¸æ©Ÿé¢¨æ ¼", "Oil Painting": "å¤å…¸æ²¹ç•« Oil", "Watercolor": "é€æ˜æ°´å½© Watercolor", "Sketch": "ç´ æè‰åœ– Sketch", "Anime": "æ—¥æœ¬å‹•æ¼« Anime", "Logo Design": "æ¨™èªŒè¨­è¨ˆ Logo", "McKinsey": "é¡§å•ç°¡å ± McKinsey"
        };
        const proAssistNames = { "bright": "ç’°å¢ƒè¼ƒæ˜äº® Bright", "dark": "ç’°å¢ƒè¼ƒæš— Dark", "realistic": "é€¼çœŸçš„ Realistic", "b/w": "é»‘ç™½ç…§ç‰‡ B/W", "very realistic": "éå¸¸é€¼çœŸ (å¼·èª¿ç´‹ç†)", "very detailed": "è±å¯Œç´°ç¯€ (å¢åŠ ç‰©ä»¶)", "high resolution": "é«˜åˆ†è¾¨ç‡ Resolution", "8K": "8K é ‚ç´šç•«è³ª" };
        const categoryMap = {
            "ProPhotography": ["macro lens", "prime lens", "long focal length lens", "wide angle lens", "fish eye lens", "tilt shift lens", "bokeh", "magic hour", "golden hour", "blue hour", "lens flare", "multiple exposure", "panning", "motion blur", "vgnetting", "ambient light", "hard light", "soft light", "back light", "rim light", "HDR", "4K HDR"],
            "Photography": ["Photo", "life photo", "group photo", "group selfie photo", "selfie photo", "portrait photography", "ports photography", "still life photo", "DSLR style", "Polaroid style", "Fujifilm", "LOMO style"],
            "Painting": ["Oil Painting", "Watercolor", "Sketch"],
            "ArtMovements": ["Renaissance", "Baroque", "Impressionism", "Surrealism", "Pop Art", "Minimalism", "Cyberpunk"],
            "FamousArtists": ["Da Vinci", "Van Gogh", "Picasso", "Dali", "Monet", "Kusama Yayoi"],
            "AnimeComics": ["Disney Animation", "Pixar Animation", "Studio Ghibli", "Anime", "Manga", "American Comic", "Claymation"],
            "DesignSpecial": ["Logo Design", "Flat Design", "Infographic", "Blueprint", "Origami", "Pixel Art", "Isometric 3D", "Low Poly", "3D Render", "LEGO"],
            "BusinessPro": ["McKinsey", "Corporate", "Professional"]
        };
        const styleSpecs = {
            "bright": { spec: "Bright lighting, high key, well-lit.", desc: "è®“ç•«é¢æ˜äº®é€šé€ã€‚" },
            "dark": { spec: "Dark atmosphere, low key lighting, moody shadows.", desc: "å‘ˆç¾å¹½æš—ç¥ç§˜çš„ç’°å¢ƒè³ªæ„Ÿã€‚" },
            "realistic": { spec: "Realistic texture, lifelike rendering.", desc: "é€¼çœŸçš„å½±åƒå‘ˆç¾ã€‚" },
            "b/w": { spec: "Black and white monochrome, classic grayscale.", desc: "ç¶“å…¸é»‘ç™½ç…§ç‰‡è³ªæ„Ÿã€‚" },
            "very realistic": { spec: "Ultra-realistic, 8k resolution, extreme focus on details and textures.", desc: "æ¥µè‡´é€¼çœŸï¼Œç‰¹åˆ¥å¼·èª¿æ¯›é«®èˆ‡ç´‹è·¯ç´°ç¯€ã€‚" },
            "very detailed": { spec: "Intricate details, extra background objects, high density elements.", desc: "è±å¯Œç´°ç¯€ï¼Œç•«é¢èƒŒæ™¯ä¸å†å–®èª¿ã€‚" },
            "high resolution": { spec: "High resolution, sharp crisp edges, clear focus.", desc: "æ¸…æ™°éŠ³åˆ©çš„é«˜åˆ†è¾¨ç‡ã€‚" },
            "8K": { spec: "8K UHD render, masterpiece quality.", desc: "8K è¶…æ¸…ç•«è³ªæ°´æº–ã€‚" }
        };

        let selectedType = 'general';
        function vibrate() { if (navigator.vibrate) navigator.vibrate(10); }

        function handleRatioChange() {
            const s = document.getElementById('ratioSelect');
            document.getElementById('customRatioBox').className = s.value === 'custom' ? 'block animate-in slide-in-from-top-2' : 'hidden';
        }

        function setType(type, btn) {
            selectedType = type;
            document.querySelectorAll('.type-btn').forEach(b => b.className = 'type-btn border-2 border-gray-100 dark:border-slate-700 p-3 rounded-2xl text-gray-500 dark:text-slate-400 text-[11px] font-medium transition-all hover:bg-gray-50 dark:hover:bg-slate-800');
            btn.className = 'type-btn ring-2 ring-purple-500 bg-purple-50 dark:bg-purple-900/30 p-3 rounded-2xl text-purple-700 dark:text-purple-300 text-[11px] font-bold transition-all shadow-sm';

            const proOption = document.getElementById('opt-pro-photo');
            const allowed = ['general', 'landscape', 'portrait'];
            if (allowed.includes(type)) { proOption.disabled = false; proOption.text = "ğŸ“¸ å°ˆæ¥­æ”å½±èˆ‡åƒæ•¸ (å¯å•Ÿç”¨è¼”åŠ©)"; }
            else { 
                proOption.disabled = true; proOption.text = "ğŸ“¸ å°ˆæ¥­æ”å½± (åƒ…é™æ”å½±é¡å‹)";
                if (document.getElementById('styleCategory').value === "ProPhotography") {
                    document.getElementById('styleCategory').value = "";
                    updateTieredUI();
                }
            }
        }

        function updateTieredUI(defaultStyle = "") {
            const cat = document.getElementById('styleCategory').value;
            const detail = document.getElementById('styleDetail');
            const assist = document.getElementById('proAssist');

            detail.innerHTML = '<option value="">2. å†é¸æ“‡å…·é«”é¢¨æ ¼...</option>';
            detail.disabled = !cat;
            if (cat && categoryMap[cat]) {
                categoryMap[cat].forEach(k => {
                    const opt = document.createElement('option');
                    opt.value = k; opt.textContent = styleDisplayNames[k] || k;
                    detail.appendChild(opt);
                });
                if (defaultStyle) detail.value = defaultStyle;
            }

            if (cat === "ProPhotography") {
                assist.disabled = false;
                assist.options[0].textContent = "3. å°ˆæ¥­æ”å½±è¼”åŠ©æè¿° (é¸å¡«)...";
            } else {
                assist.disabled = true; assist.value = "";
                assist.options[0].textContent = "3. å°ˆæ¥­æ”å½±è¼”åŠ© (é–å®šä¸­)...";
            }
            updatePreview();
        }

        function randomStyleOnly() {
            vibrate();
            const icon = document.getElementById('diceIcon');
            icon.classList.add('rolling'); setTimeout(() => icon.classList.remove('rolling'), 600);
            const allowed = ['general', 'landscape', 'portrait'];
            let cats = Object.keys(categoryMap);
            if (!allowed.includes(selectedType)) cats = cats.filter(c => c !== "ProPhotography");
            const randomCat = cats[Math.floor(Math.random() * cats.length)];
            document.getElementById('styleCategory').value = randomCat;
            updateTieredUI(categoryMap[randomCat][Math.floor(Math.random() * categoryMap[randomCat].length)]);
        }

        function updatePreview() {
            const d = document.getElementById('styleDetail').value;
            const a = document.getElementById('proAssist').value;
            const card = document.getElementById('previewCard');
            if (d || a) { document.getElementById('previewText').innerText = "ğŸ’¡ é¸é …å·²é…ç½®ï¼Œæº–å‚™ç”Ÿæˆå¤§å¸«æŒ‡ä»¤ã€‚"; card.classList.remove('hidden'); }
            else { card.classList.add('hidden'); }
        }

        function generate() {
            const content = document.getElementById('content').value.trim() || "Masterpiece";
            const style = document.getElementById('styleDetail').value;
            const assist = document.getElementById('proAssist').value;
            if(!style) return alert('è«‹é¸æ“‡è¦–è¦ºé¢¨æ ¼ï¼');
            
            const ratioSelect = document.getElementById('ratioSelect').value;
            let arValue = ratioSelect === 'custom' ? (document.getElementById('customRatioInput').value || "1:1") : ratioSelect;
            
            const prompt = `/imagine prompt: A ${style} ${assist || ""} style ${selectedType} showcasing ${content} --ar ${arValue} --no text, words, letters, font, watermark, logo, signature --v 6.1`;
            
            document.getElementById('finalPrompt').innerText = prompt;
            document.getElementById('resultBox').classList.remove('hidden');
        }

        function copyText() { navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText); alert('æŒ‡ä»¤å·²è¤‡è£½ï¼'); }
        function shareLine() { window.open(`https://line.me/R/msg/text/?${encodeURIComponent(document.getElementById('finalPrompt').innerText)}`); }
        function shareFB() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${window.location.href}`); }
    </script>
</body>
</html>
