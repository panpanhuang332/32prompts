<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸€æŒ‡æç¤º (çµ‚æ¥µå®Œæ•´ç‰ˆ)</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050505">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-deep: #050505;
            --glass-border: rgba(255, 255, 255, 0.12);
            --text-main: #E0E0E0;
            --accent-glow: #3b82f6;
            --study-purple: #9c27b0;
        }
        body {
            background-color: var(--bg-deep); color: var(--text-main); font-family: 'Noto Sans TC', sans-serif;
            height: 100vh; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #050505 60%);
        }
        .app-header { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(12px); padding: 15px 15px 5px 15px; border-bottom: 1px solid rgba(255,255,255,0.08); flex-shrink: 0; z-index: 100; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .app-title { margin: 0; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.1rem; letter-spacing: 1px; color: #fff; }
        
        .mode-switch-container { display: flex; gap: 8px; margin-bottom: 12px; background: rgba(255,255,255,0.03); padding: 4px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .mode-btn { flex: 1; border: none; background: transparent; padding: 8px; font-size: 0.85rem; border-radius: 8px; color: #666; transition: all 0.3s; }
        .mode-btn.active { background: #222; color: #fff; }
        .mode-btn.mode-study.active { border-color: var(--study-purple); color: #e1bee7; }

        .app-content { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .tab-content-area { display: none; }
        .tab-content-area.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .category-card { background: linear-gradient(145deg, #111, #080808); border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        .category-title { font-size: 0.85rem; color: #fff; margin-bottom: 10px; border-left: 3px solid var(--accent-glow); padding-left: 10px; display: block; }
        .form-select { background-color: #080808; border: 1px solid #333; color: #fff; border-radius: 10px; font-size: 0.9rem; }

        .nav-tabs { border: none; gap: 8px; padding-bottom: 10px; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-link { border: 1px solid transparent; border-radius: 20px; background: rgba(255,255,255,0.05); color: #888; font-size: 0.8rem; padding: 6px 14px; white-space: nowrap; transition: all 0.2s; }
        .nav-link.active { background: #fff; color: #000; font-weight: 700; }
        .nav-link.disabled-tab { opacity: 0.3; cursor: not-allowed; }

        .app-footer { background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px); padding: 15px 20px 25px 20px; border-top: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .output-box { background-color: #000; border: 1px solid #333; border-radius: 12px; padding: 10px; margin-bottom: 10px; position: relative; }
        .prompt-label { font-size: 0.65rem; color: #888; margin-bottom: 5px; display: block; font-weight: 700; }
        textarea { width: 100%; background: transparent; border: none; outline: none; resize: none; font-family: monospace; font-size: 0.85rem; line-height: 1.4; color: #00ff9d; }
        #translationPrompt { color: #3b82f6; }

        .btn-speak { position: absolute; right: 10px; top: 10px; background: #222; color: #fff; border: 1px solid #444; border-radius: 50px; font-size: 0.65rem; padding: 2px 8px; }
        .locked-badge { display: none; font-size: 0.7rem; color: #ff5252; margin-left: 4px; }
        .camera-preview-box { width: 50px; height: 50px; border-radius: 8px; border: 1px solid #444; overflow: hidden; display: none; margin-right: 10px; position: relative; }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="top-bar">
            <h6 class="app-title">âœ¨ Prompts Language PRO</h6>
            <button id="loginBtn" class="btn btn-sm btn-outline-light rounded-pill" onclick="googleLogin()">ç™»å…¥</button>
            <div id="userInfo" style="display:none; align-items:center; gap:8px;">
                <img id="userPhoto" src="" style="width:28px; border-radius:50%;">
                <span id="userName" style="font-size:0.8rem; color:#bbb;"></span>
            </div>
        </div>
        
        <div class="mode-switch-container">
            <button class="mode-btn active" onclick="setMode('create')" id="mode-create">ğŸ¨ å‰µä½œæŒ‡ä»¤</button>
            <button class="mode-btn mode-study" onclick="setMode('study')" id="mode-study">ğŸ”® å­¸ç¿’æ¨¡å¼ (Reverse)</button>
        </div>

        <div class="d-flex align-items-center mb-2">
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleImageSelect(this)">
            <div id="previewBox" class="camera-preview-box">
                <img id="finalImage" style="width:100%;height:100%;object-fit:cover;">
                <button onclick="clearPhoto()" style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.7); color:white; border:none; width:100%; font-size:9px;">âœ•</button>
            </div>
            <div class="input-group" id="mainInputGroup">
                <input type="text" class="form-control form-control-sm" id="mainSubject" placeholder="è¼¸å…¥ä¸»é¡Œ (å¦‚: è²“)...">
                <button class="btn btn-sm btn-dark" onclick="translateInput()">ä¸­è½‰è‹±</button>
            </div>
            <button class="btn btn-sm btn-danger ms-2" id="cameraBtn" style="display:none; border-radius:10px; white-space:nowrap;" onclick="triggerCamera()">ğŸ“¸ æ‹ç…§å­¸ç¿’</button>
        </div>

        <div class="nav nav-tabs" id="myTab">
            <button class="nav-link active" onclick="switchTab(this, 'page-settings')">âš™ï¸ è¨­å®š</button>
            <button class="nav-link" onclick="switchTab(this, 'page-char')">ğŸ‘¤ äººç‰©</button>
            <button class="nav-link" onclick="switchTab(this, 'page-scene')">ğŸï¸ å ´æ™¯</button>
            <button class="nav-link disabled-tab" id="btn-photo" onclick="switchTab(this, 'page-photo')">ğŸ“¸ æ”å½±</button>
            <button class="nav-link disabled-tab" id="btn-art" onclick="switchTab(this, 'page-art')">ğŸ–Œï¸ è—è¡“ <span class="locked-badge">ğŸ”’</span></button>
            <button class="nav-link disabled-tab" id="btn-anime" onclick="switchTab(this, 'page-anime')">ğŸ§¸ å‹•æ¼« <span class="locked-badge">ğŸ”’</span></button>
        </div>
    </div>

    <div class="app-content">
        <div id="page-settings" class="tab-content-area active">
            <div class="category-card">
                <label class="category-title">ğŸ“ åœ–ç‰‡æ¯”ä¾‹</label>
                <select class="form-select form-select-sm" id="aspectRatio">
                    <option value="">1:1 (é è¨­)</option>
                    <option value="--ar 16:9">16:9 (å¯¬è¢å¹•)</option>
                    <option value="--ar 9:16">9:16 (æ‰‹æ©Ÿç›´å¼)</option>
                    <option value="--ar 4:3">4:3 (æ¨™æº–ç…§ç‰‡)</option>
                </select>
            </div>
            <div class="category-card">
                <label class="category-title">ğŸ’ è¼”åŠ©è© (ç´°ç¯€èˆ‡å…‰å½±)</label>
                <select class="form-select form-select-sm" id="auxWords">
                    <option value="">ä¸æŒ‡å®š</option>
                    <option value="bright">bright (ç’°å¢ƒæ˜äº®)</option>
                    <option value="dark">dark (ç’°å¢ƒè¼ƒæš—)</option>
                    <option value="realistic">realistic (é€¼çœŸçš„)</option>
                    <option value="very realistic, highly textured">very realistic (å¼·èª¿ç´‹ç†)</option>
                    <option value="very detailed, intricate">very detailed (ç´°éƒ¨ç‰©ä»¶)</option>
                    <option value="8K resolution, high resolution">8K (ç•«è³ªå¼·åŒ–)</option>
                    <option value="b/w, monochrome">b/w (é»‘ç™½é¢¨æ ¼)</option>
                </select>
            </div>
        </div>

        <div id="page-char" class="tab-content-area"><div id="container-char"></div></div>
        <div id="page-scene" class="tab-content-area"><div id="container-scene"></div></div>
        <div id="page-photo" class="tab-content-area"><div id="container-photo"></div></div>
        <div id="page-art" class="tab-content-area"><div id="container-art"></div></div>
        <div id="page-anime" class="tab-content-area"><div id="container-anime"></div></div>
    </div>

    <div class="app-footer">
        <div class="output-box">
            <span class="prompt-label">ENGLISH PROMPTS</span>
            <button class="btn-speak" onclick="speakText()">ğŸ”Š æœ—è®€</button>
            <textarea id="outputPrompt" rows="2" readonly placeholder="é¸å–é¸é …æˆ–æ‹ç…§..."></textarea>
        </div>
        <div class="output-box" id="translationBox" style="display:none; border-color: #1e3a8a;">
            <span class="prompt-label">ä¸­æ–‡å°ç…§ç¿»è­¯</span>
            <textarea id="translationPrompt" rows="1" readonly></textarea>
        </div>
        <button class="btn btn-primary w-100 fw-bold py-2" style="border-radius:12px;" id="actionBtn" onclick="generatePrompt()">âœ¨ ç”¢å‡ºæŒ‡ä»¤</button>
    </div>

<script>
    // ==========================================
    // âš ï¸ å®Œæ•´çš„éºå¤±è³‡æ–™åº«é‡æ–°æ¤å…¥
    // ==========================================
    const categorizedData = {
        "char": {
            "æœè£ç©¿æ­": [{val: "T-shirt and jeans", label: "Tæ¤ç‰›ä»”è¤²"}, {val: "Suit and tie", label: "è¥¿è£"}, {val: "Evening gown", label: "æ™šç¦®æœ"}, {val: "Cyberpunk techwear", label: "æ©Ÿèƒ½é¢¨"}, {val: "Kimono", label: "å’Œæœ"}, {val: "School uniform", label: "åˆ¶æœ"}, {val: "Maid outfit", label: "å¥³åƒ•è£"}, {val: "Sportswear", label: "é‹å‹•æœ"}, {val: "Hoodie", label: "é€£å¸½è¡«"}, {val: "Armor", label: "ç›”ç”²"}],
            "é«®å‹é«®è‰²": [{val: "Long straight black hair", label: "é»‘é•·ç›´"}, {val: "Short bob cut", label: "é®‘ä¼¯é ­"}, {val: "Blonde ponytail", label: "é‡‘é«®é¦¬å°¾"}, {val: "Silver twin tails", label: "éŠ€é«®é›™é¦¬å°¾"}, {val: "Pink hair", label: "ç²‰é«®"}, {val: "Messy hair", label: "å‡Œäº‚é«®"}, {val: "Bald", label: "å…‰é ­"}, {val: "Curly hair", label: "æ²é«®"}],
            "äº”å®˜ç‰¹é»": [{val: "Blue eyes", label: "è—çœ¼"}, {val: "Red eyes", label: "ç´…çœ¼"}, {val: "Heterochromia", label: "ç•°è‰²ç³"}, {val: "Cat eyes", label: "è²“çœ¼"}, {val: "Wearing glasses", label: "çœ¼é¡"}, {val: "Freckles", label: "é›€æ–‘"}, {val: "Scar on face", label: "åˆ€ç–¤"}, {val: "Makeup", label: "åŒ–å¦"}],
            "è¡¨æƒ…ç‹€æ…‹": [{val: "Smile", label: "å¾®ç¬‘"}, {val: "Laughing", label: "å¤§ç¬‘"}, {val: "Crying", label: "å“­æ³£"}, {val: "Angry", label: "ç”Ÿæ°£"}, {val: "Expressionless", label: "ç„¡è¡¨æƒ…"}, {val: "Seductive", label: "èª˜æƒ‘"}, {val: "Surprised", label: "é©šè¨"}, {val: "Winking", label: "çœ¨çœ¼"}],
            "è‚¢é«”å‹•ä½œ": [{val: "Standing", label: "ç«™ç«‹"}, {val: "Sitting", label: "åè‘—"}, {val: "Lying", label: "èººè‘—"}, {val: "Running", label: "å¥”è·‘"}, {val: "Jumping", label: "è·³èº"}, {val: "Fighting stance", label: "æˆ°é¬¥å§¿å‹¢"}, {val: "Peace sign", label: "æ¯”YA"}, {val: "Looking back", label: "å›çœ¸"}]
        },
        "scene": {
            "ç’°å¢ƒè¨­å®š": [{val: "Indoor", label: "å®¤å…§"}, {val: "Outdoor", label: "å®¤å¤–"}, {val: "Primitive Forest", label: "åŸå§‹æ£®æ—"}, {val: "Underwater", label: "æµ·åº•"}, {val: "Outer Space", label: "å¤ªç©º"}, {val: "Concert Stage", label: "æ¼”å”±æœƒ"}, {val: "Future City", label: "æœªä¾†åŸå¸‚"}],
            "ç‰¹å®šåœ°é»": [{val: "News Anchor Desk", label: "ä¸»æ’­å°"}, {val: "Church", label: "æ•™å ‚"}, {val: "Rooftop style of Infernal Affairs", label: "å¤©å°"}, {val: "Prison Cell", label: "ç›£ç„"}, {val: "Courtroom", label: "æ³•é™¢"}, {val: "Classroom", label: "æ•™å®¤"}, {val: "Cyberpunk Street", label: "è³½åšè¡—é“"}, {val: "Ancient Temple", label: "å¤å»Ÿ"}],
            "èƒŒæ™¯è™•ç†": [{val: "White Background", label: "ç™½èƒŒæ™¯"}, {val: "Simple Background", label: "ç°¡å–®èƒŒæ™¯"}, {val: "Green Screen", label: "ç¶ å¹•"}]
        },
        "photo": {
            "æ”å½±é¡å‹": [{id: "photo_type", val: "photo", label: "ç…§ç‰‡"}, {id: "photo_type", val: "portrait photography", label: "äººåƒ"}, {id: "photo_type", val: "life photo", label: "ç”Ÿæ´»ç…§"}, {id: "photo_type", val: "macro photography", label: "å¾®è·"}, {id: "photo_type", val: "selfie photo", label: "è‡ªæ‹"}],
            "å…‰åœˆ": [{id:"ap", val:"f/1", label:"f/1"}, {id:"ap", val:"f/1.4", label:"f/1.4"}, {id:"ap", val:"f/2.8", label:"f/2.8"}, {id:"ap", val:"f/8", label:"f/8"}, {id:"ap", val:"f/16", label:"f/16"}, {id:"ap", val:"f/32", label:"f/32"}],
            "ç„¦è·": [{id:"focal", val:"20mm", label:"20mm"}, {id:"focal", val:"35mm", label:"35mm"}, {id:"focal", val:"85mm", label:"85mm"}, {id:"focal", val:"200mm", label:"200mm"}, {id:"focal", val:"600mm", label:"600mm"}],
            "ç›¸æ©Ÿé¢¨æ ¼": [{val:"Polaroid style", label:"æ‹ç«‹å¾—"}, {val:"GoPro style", label:"GoPro"}, {val:"Fujifilm style", label:"å¯Œå£«åº•ç‰‡"}, {val:"Movie style", label:"é›»å½±æ„Ÿ"}]
        },
        "art": {
            "ç¹ªç•«åª’æ": [{val:"illustration", label:"æ’ç•«"}, {val:"watercolor painting", label:"æ°´å½©"}, {val:"oil painting", label:"æ²¹ç•«"}, {val:"ink drawing", label:"æ°´å¢¨"}],
            "æµæ´¾å¤§å¸«": [{val:"Vincent van Gogh", label:"æ¢µè°·"}, {val:"Picasso", label:"ç•¢å¡ç´¢"}, {val:"Claude Monet", label:"è«å…§"}, {val:"Salvador Dali", label:"é”åˆ©"}, {val:"Andy Warhol", label:"å®‰è¿ªæ²ƒè·"}]
        },
        "anime": {
            "ç¶“å…¸ä½œå“": [{val: "One Piece style", label: "èˆªæµ·ç‹"}, {val: "Detective Conan style", label: "ååµæ¢æŸ¯å—"}, {val: "Naruto style", label: "ç«å½±å¿è€…"}, {val: "Studio Ghibli style", label: "å‰åœåŠ›"}, {val: "Sailor Moon style", label: "ç¾å°‘å¥³æˆ°å£«"}, {val: "Dragon ball style", label: "ä¸ƒé¾ç "}]
        }
    };

    function init() {
        // åˆå§‹åŒ–æ‰€æœ‰å¤§é¡ä¸‹çš„ç´°é …
        for (const [tabKey, categories] of Object.entries(categorizedData)) {
            const container = document.getElementById(`container-${tabKey}`);
            if (!container) continue;
            container.innerHTML = "";
            for (const [catName, items] of Object.entries(categories)) {
                const card = document.createElement('div'); card.className = 'category-card';
                card.innerHTML = `<label class="category-title">${catName}</label>`;
                const select = document.createElement('select'); select.className = 'form-select form-select-sm category-select';
                if (items[0].id) select.id = items[0].id;
                select.appendChild(new Option("ä¸æŒ‡å®š", ""));
                items.forEach(item => select.appendChild(new Option(item.label, item.val)));
                card.appendChild(select); container.appendChild(card);
            }
        }
        document.getElementById('photo_type')?.addEventListener('change', checkLocks);
        
        // Firebase ç‹€æ…‹ç›£è½
        const firebaseConfig = {
            apiKey: "AIzaSyBHwTNxIIQ0dZVI6beyZa4K5S3y8Brh96g",
            authDomain: "ntu-test-54b93.firebaseapp.com",
            projectId: "ntu-test-54b93",
            storageBucket: "ntu-test-54b93.firebasestorage.app",
            messagingSenderId: "953553108630",
            appId: "1:953553108630:web:6081f44a95a0baf71e4cb7"
        };
        try { 
            firebase.initializeApp(firebaseConfig);
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    isLoggedIn = true;
                    document.getElementById('loginBtn').style.display = 'none';
                    document.getElementById('userInfo').style.display = 'flex';
                    document.getElementById('userPhoto').src = user.photoURL;
                    document.getElementById('userName').textContent = user.displayName;
                    document.querySelectorAll('.nav-link').forEach(btn => btn.classList.remove('disabled-tab'));
                    checkLocks();
                } else {
                    isLoggedIn = false;
                    document.getElementById('loginBtn').style.display = 'flex';
                    document.getElementById('userInfo').style.display = 'none';
                    ['btn-photo', 'btn-art', 'btn-anime'].forEach(id => document.getElementById(id)?.classList.add('disabled-tab'));
                }
            });
        } catch(e) {}
    }

    let isLoggedIn = false;

    function checkLocks() {
        if (!isLoggedIn) return;
        const photoVal = document.getElementById('photo_type').value;
        const isPhoto = photoVal !== "";
        ['ap', 'focal'].forEach(id => {
            const el = document.getElementById(id);
            if(el) { el.disabled = !isPhoto; if(!isPhoto) el.value=""; }
        });
        toggleLock('container-art', 'btn-art', isPhoto);
        toggleLock('container-anime', 'btn-anime', isPhoto);
    }

    function toggleLock(cid, bid, lock) {
        const c = document.getElementById(cid); const b = document.getElementById(bid);
        if(c) c.querySelectorAll('select').forEach(s => { s.disabled = lock; if(lock) s.value=""; });
        if(b) { b.classList.toggle('disabled-tab', lock); b.querySelector('.locked-badge').style.display = lock ? 'inline' : 'none'; }
    }

    function switchTab(btn, id) {
        if(btn.classList.contains('disabled-tab')) {
            if(!isLoggedIn) alert("ğŸ”’ è«‹ç™»å…¥è§£é–åŠŸèƒ½");
            else alert("âš ï¸ æ”å½±æ¨¡å¼èˆ‡è—è¡“/å‹•æ¼«è¡çª");
            return;
        }
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content-area').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function generatePrompt() {
        if (document.getElementById('mode-study').classList.contains('active')) {
            if (!document.getElementById('finalImage').src.includes('data:image')) return alert("è«‹æ‹ç…§ï¼");
            document.getElementById('outputPrompt').value = "A cinematic shot with natural lighting.";
            document.getElementById('translationPrompt').value = "ä¸€å¼µå…·æœ‰è‡ªç„¶å…‰å½±çš„é›»å½±æ„Ÿé¡é ­ã€‚";
        } else {
            const parts = [];
            const sub = document.getElementById('mainSubject').value; if(sub) parts.push(sub);
            document.querySelectorAll('.app-content select').forEach(s => {
                if(s.value && !s.disabled && s.id !== 'aspectRatio' && s.id !== 'auxWords') parts.push(s.value);
            });
            const aux = document.getElementById('auxWords').value; if(aux) parts.push(aux);
            const ar = document.getElementById('aspectRatio').value; if(ar) parts.push(ar);
            document.getElementById('outputPrompt').value = parts.join(", ");
        }
    }

    function setMode(mode) {
        const isStudy = mode === 'study';
        document.getElementById('mode-create').classList.toggle('active', !isStudy);
        document.getElementById('mode-study').classList.toggle('active', isStudy);
        document.getElementById('mainInputGroup').style.display = isStudy ? 'none' : 'flex';
        document.getElementById('cameraBtn').style.display = isStudy ? 'block' : 'none';
        document.getElementById('myTab').style.display = isStudy ? 'none' : 'flex';
        document.getElementById('translationBox').style.display = isStudy ? 'block' : 'none';
        document.querySelectorAll('.tab-content-area').forEach(el => el.classList.remove('active'));
        if(!isStudy) document.getElementById('page-settings').classList.add('active');
    }

    function googleLogin() { firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
    function speakText() {
        const t = document.getElementById('outputPrompt').value;
        if(t) { const u = new SpeechSynthesisUtterance(t); u.lang='en-US'; window.speechSynthesis.speak(u); }
    }
    function triggerCamera() { document.getElementById('cameraInput').click(); }
    function handleImageSelect(i) {
        if (i.files[0]) {
            const r = new FileReader();
            r.onload = (e) => { document.getElementById('finalImage').src = e.target.result; document.getElementById('previewBox').style.display = 'block'; };
            r.readAsDataURL(i.files[0]);
        }
    }
    function clearPhoto() { document.getElementById('finalImage').src = ""; document.getElementById('previewBox').style.display = 'none'; }
    async function translateInput() {
        const t = document.getElementById('mainSubject').value; if(!t) return;
        const res = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=zh-TW|en`);
        const data = await res.json(); document.getElementById('mainSubject').value = data.responseData.translatedText;
    }

    init();
</script>
</body>
</html>
