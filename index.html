<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸€æŒ‡æç¤º (æ•™è‚²å­¸ç¿’ Proç‰ˆ)</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050505">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg-deep: #050505;
            --glass-border: rgba(255, 255, 255, 0.12);
            --text-main: #E0E0E0;
            --accent-glow: #3b82f6;
            --study-purple: #9c27b0;
        }
        body {
            background-color: var(--bg-deep); 
            color: var(--text-main); 
            font-family: 'Noto Sans TC', sans-serif;
            height: 100vh; height: 100dvh;
            display: flex; flex-direction: column;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1a1a1a 0%, #050505 60%);
        }

        .app-header {
            background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(12px);
            padding: 15px 15px 5px 15px; border-bottom: 1px solid rgba(255,255,255,0.08); 
            flex-shrink: 0; z-index: 100;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .app-title { 
            margin: 0; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.1rem; letter-spacing: 1px;
            background: linear-gradient(90deg, #fff, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        /* ç™»å…¥è³‡è¨Š */
        .user-info { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: #bbb; cursor: pointer; }
        .user-avatar { width: 30px; height: 30px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.3); }
        .btn-google-login { font-size: 0.8rem; padding: 6px 14px; border-radius: 50px; background: #1a1a1a; border: 1px solid var(--glass-border); color: #ccc; }

        /* æ¨¡å¼åˆ‡æ› */
        .mode-switch-container { display: flex; gap: 8px; margin-bottom: 15px; background: rgba(255,255,255,0.03); padding: 4px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .mode-btn { flex: 1; border: none; background: transparent; padding: 8px; font-size: 0.85rem; border-radius: 8px; color: #666; font-weight: 500; transition: all 0.3s; }
        .mode-btn.active { background: linear-gradient(145deg, #222, #111); color: #fff; border: 1px solid rgba(255,255,255,0.1); }
        .mode-btn.mode-study.active { border-color: var(--study-purple); color: #e1bee7; }

        /* ä¸»å…§å®¹å€ */
        .app-content { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .tab-content-area { display: none; animation: fadeIn 0.3s ease; }
        .tab-content-area.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .category-card { background: linear-gradient(145deg, #111, #080808); border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); border-top: 1px solid rgba(255,255,255,0.15); }
        .category-title { font-size: 0.9rem; color: #fff; margin-bottom: 10px; border-left: 3px solid var(--accent-glow); padding-left: 10px; display: block; }

        /* åˆ†é æ¨™ç±¤ */
        .nav-tabs { border: none; gap: 8px; padding-bottom: 10px; flex-wrap: nowrap; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-link { border: 1px solid transparent; border-radius: 20px; background: rgba(255,255,255,0.05); color: #888; font-size: 0.85rem; padding: 6px 14px; white-space: nowrap; transition: all 0.2s; }
        .nav-link.active { background: #fff; color: #000; font-weight: 700; }
        .nav-link.disabled-tab { opacity: 0.3; cursor: not-allowed; }

        /* åº•éƒ¨å€åŸŸ */
        .app-footer { background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(15px); padding: 15px 20px 25px 20px; border-top: 1px solid rgba(255,255,255,0.1); flex-shrink: 0; }
        .output-box { background-color: #000; border: 1px solid #333; border-radius: 12px; padding: 10px; margin-bottom: 8px; position: relative; }
        .prompt-label { font-size: 0.65rem; color: #888; margin-bottom: 4px; display: block; font-weight: 700; letter-spacing: 1px; }
        
        textarea { width: 100%; background: transparent; border: none; outline: none; resize: none; font-family: monospace; font-size: 0.85rem; line-height: 1.4; }
        #outputPrompt { color: #00ff9d; }
        #translationPrompt { color: #3b82f6; }

        .btn-speak { position: absolute; right: 10px; top: 10px; background: #222; color: #fff; border: 1px solid #444; border-radius: 50px; font-size: 0.65rem; padding: 2px 8px; }

        /* ç›¸ç‰‡é è¦½ */
        .camera-preview-box { width: 50px; height: 50px; border-radius: 8px; border: 1px solid #444; overflow: hidden; display: none; margin-right: 10px; position: relative; }
        
        .locked-badge { display: none; font-size: 0.7rem; color: #ff5252; margin-left: 5px; }
    </style>
</head>
<body>

    <div class="app-header">
        <div class="top-bar">
            <h6 class="app-title">âœ¨ Prompts Language <span style="font-size:0.7em; opacity:0.7;">PRO</span></h6>
            <button id="loginBtn" class="btn-google-login" onclick="googleLogin()">ç™»å…¥</button>
            <div id="userInfo" class="user-info" style="display: none;" onclick="googleLogout()">
                <img id="userPhoto" src="" class="user-avatar">
                <span id="userName">User</span>
            </div>
        </div>
        
        <div class="mode-switch-container">
            <button class="mode-btn active" onclick="setMode('create')" id="mode-create">ğŸ¨ ç¹ªåœ–æŒ‡ä»¤</button>
            <button class="mode-btn mode-study" onclick="setMode('study')" id="mode-study">ğŸ”® å­¸ç¿’æ¨¡å¼ (é–‹ç™¼ä¸­)</button>
        </div>

        <div class="d-flex align-items-center mb-2">
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleImageSelect(this)">
            <div id="previewBox" class="camera-preview-box">
                <img id="finalImage" style="width:100%;height:100%;object-fit:cover;">
                <button onclick="clearPhoto()" style="position:absolute; top:0; right:0; background:rgba(0,0,0,0.7); color:white; border:none; width:100%; font-size:9px;">âœ•</button>
            </div>
            <div class="input-group" id="mainInputGroup">
                <input type="text" class="form-control" id="mainSubject" placeholder="è¼¸å…¥å…§å®¹ (å¦‚: è²“)...">
                <button class="btn btn-dark" type="button" onclick="translateInput()">ä¸­è½‰è‹±</button>
            </div>
            <button class="btn btn-danger ms-2" id="cameraBtn" style="display:none; border-radius:12px; white-space:nowrap;" onclick="triggerCamera()">ğŸ“¸ æ‹ç…§å­¸ç¿’</button>
        </div>

        <div class="nav nav-tabs" id="myTab">
            <button class="nav-link active" onclick="switchTab(this, 'page-settings')">âš™ï¸ è¨­å®š</button>
            <button class="nav-link" onclick="switchTab(this, 'page-char')">ğŸ‘¤ äººç‰©</button>
            <button class="nav-link" onclick="switchTab(this, 'page-scene')">ğŸï¸ å ´æ™¯</button>
            <button class="nav-link disabled-tab" id="btn-photo" onclick="switchTab(this, 'page-photo')">ğŸ“¸ æ”å½±</button>
            <button class="nav-link disabled-tab" id="btn-art" onclick="switchTab(this, 'page-art')">ğŸ–Œï¸ è—è¡“ <span class="locked-badge">ğŸ”’</span></button>
            <button class="nav-link disabled-tab" id="btn-anime" onclick="switchTab(this, 'page-anime')">ğŸ§¸ å‹•æ¼« <span class="locked-badge">ğŸ”’</span></button>
        </div>
    </div>

    <div class="app-content">
        <div id="study-hint" style="display:none;" class="category-card">
            <p class="small text-info mb-0">æœªä¾†å°‡é€é Vision AI è§£æç›¸ç‰‡ï¼š<br>1. é»æ“Šã€Œæ‹ç…§å­¸ç¿’ã€ 2. ä¸‹æ–¹å°‡å‡ºç¾è¦–è¦ºå–®å­—èˆ‡ç¿»è­¯ 3. æŒ‰ä¸‹èªéŸ³åœ–ç¤ºå­¸ç¿’ç™¼éŸ³ã€‚</p>
        </div>

        <div id="page-settings" class="tab-content-area active">
            <div class="category-card">
                <label class="category-title">ğŸ“ åœ–ç‰‡æ¯”ä¾‹ (Aspect Ratio)</label>
                <select class="form-select" id="aspectRatio">
                    <option value="">1:1 (é è¨­)</option>
                    <option value="--ar 16:9">16:9 (å¯¬è¢å¹•)</option>
                    <option value="--ar 9:16">9:16 (æ‰‹æ©Ÿç›´å¼)</option>
                    <option value="--ar 4:3">4:3 (æ¨™æº–ç…§ç‰‡)</option>
                </select>
            </div>
            <div class="category-card">
                <label class="category-title">âœ¨ è¼”åŠ©ä¿®é£¾è© (Auxiliary)</label>
                <select class="form-select" id="auxiliaryWords">
                    <option value="">ä¸æŒ‡å®š</option>
                    <option value="bright">bright (ç’°å¢ƒè¼ƒæ˜äº®)</option>
                    <option value="dark">dark (ç’°å¢ƒè¼ƒæš—)</option>
                    <option value="realistic">realistic (é€¼çœŸçš„)</option>
                    <option value="very realistic, detailed texture">very realistic (å¼·èª¿ç´‹ç†)</option>
                    <option value="very detailed, intricate">very detailed (ç´°éƒ¨ç‰©ä»¶)</option>
                    <option value="high resolution">high resolution (é«˜åˆ†è¾¨ç‡)</option>
                    <option value="8K, masterpiece">8K (ç•«è³ªå¼·åŒ–)</option>
                    <option value="b/w photo">b/w (é»‘ç™½ç…§ç‰‡)</option>
                </select>
            </div>
        </div>

        <div id="page-char" class="tab-content-area"><div id="container-char"></div></div>
        <div id="page-scene" class="tab-content-area"><div id="container-scene"></div></div>
        <div id="page-photo" class="tab-content-area"><div id="container-photo"></div></div>
        <div id="page-art" class="tab-content-area"><div id="container-art"></div></div>
        <div id="page-anime" class="tab-content-area"><div id="container-anime"></div></div>
    </div>

    <div class="app-footer">
        <div class="output-box">
            <span class="prompt-label">ENGLISH PROMPTS / LEARNING</span>
            <button class="btn-speak" onclick="speakText()">ğŸ”Š å”¸çµ¦æˆ‘è½</button>
            <textarea id="outputPrompt" rows="2" readonly placeholder="é¸å–ä¸Šæ–¹é¸é …æˆ–æ‹ç…§..."></textarea>
        </div>
        
        <div class="output-box" id="translationBox" style="display:none; border-color: #1e3a8a;">
            <span class="prompt-label">ä¸­æ–‡å°ç…§ç¿»è­¯</span>
            <textarea id="translationPrompt" rows="1" readonly placeholder="ç¿»è­¯å°‡é¡¯ç¤ºæ–¼æ­¤..."></textarea>
        </div>

        <button class="btn btn-primary w-100 fw-bold py-2" style="border-radius:12px;" id="actionBtn" onclick="generatePrompt()">âœ¨ ç”¢å‡ºç¹ªåœ–æŒ‡ä»¤</button>
    </div>

<script>
    // --- è³‡æ–™çµæ§‹å®Œå…¨å›æ­¸ ---
    const categorizedData = {
        "char": { 
            "æœè£ç©¿æ­": [{val: "T-shirt and jeans", label: "Tæ¤ç‰›ä»”è¤²"}, {val: "Suit and tie", label: "è¥¿è£"}, {val: "Evening gown", label: "æ™šç¦®æœ"}, {val: "Cyberpunk techwear", label: "æ©Ÿèƒ½é¢¨"}, {val: "Kimono", label: "å’Œæœ"}, {val: "Maid outfit", label: "å¥³åƒ•è£"}],
            "é«®å‹é«®è‰²": [{val: "Long straight black hair", label: "é»‘é•·ç›´"}, {val: "Short bob cut", label: "é®‘ä¼¯é ­"}, {val: "Blonde ponytail", label: "é‡‘é«®é¦¬å°¾"}, {val: "Silver twin tails", label: "éŠ€é«®é›™é¦¬å°¾"}],
            "è¡¨æƒ…": [{val: "Smile", label: "å¾®ç¬‘"}, {val: "Laughing", label: "å¤§ç¬‘"}, {val: "Crying", label: "å“­æ³£"}, {val: "Angry", label: "ç”Ÿæ°£"}],
            "è‚¢é«”å‹•ä½œ": [{val: "Standing", label: "ç«™ç«‹"}, {val: "Sitting", label: "åè‘—"}, {val: "Running", label: "å¥”è·‘"}, {val: "Peace sign", label: "æ¯”YA"}]
        },
        "scene": { 
            "ç’°å¢ƒè¨­å®š": [{val: "Indoor", label: "å®¤å…§"}, {val: "Outdoor", label: "å®¤å¤–"}, {val: "Primitive Forest", label: "åŸå§‹æ£®æ—"}, {val: "Underwater", label: "æµ·åº•"}, {val: "Outer Space", label: "å¤ªç©º"}],
            "ç‰¹å®šåœ°é»": [{val: "News Anchor Desk", label: "ä¸»æ’­å°"}, {val: "Church", label: "æ•™å ‚"}, {val: "Cyberpunk Street", label: "è³½åšè¡—é“"}, {val: "Ancient Temple", label: "å¤å»Ÿ"}]
        },
        "photo": { 
            "æ”å½±é¡å‹": [{id: "photo_type", val: "photo", label: "ç…§ç‰‡"}, {id: "photo_type", val: "portrait photography", label: "äººåƒ"}, {id: "photo_type", val: "life photo", label: "ç”Ÿæ´»ç…§"}, {id: "photo_type", val: "sports photography", label: "é‹å‹•"}],
            "å…‰åœˆ": [
                {id:"photo_aperture", val:"f/1", label:"f/1"}, {id:"photo_aperture", val:"f/1.4", label:"f/1.4"}, 
                {id:"photo_aperture", val:"f/2.8", label:"f/2.8"}, {id:"photo_aperture", val:"f/8", label:"f/8"}, 
                {id:"photo_aperture", val:"f/16", label:"f/16"}, {id:"photo_aperture", val:"f/32", label:"f/32"}
            ],
            "ç„¦è·": [
                {id:"photo_focal", val:"20mm", label:"20mm"}, {id:"photo_focal", val:"35mm", label:"35mm"}, 
                {id:"photo_focal", val:"85mm", label:"85mm"}, {id:"photo_focal", val:"200mm", label:"200mm"}, 
                {id:"photo_focal", val:"600mm", label:"600mm"}
            ],
            "é¢¨æ ¼æ•ˆæœ": [{val:"bokeh", label:"æ•£æ™¯"}, {val:"magic hour", label:"é­”å¹»æ™‚åˆ»"}, {val:"double exposure", label:"é‡è¤‡æ›å…‰"}]
        },
        "art": { 
            "ç¹ªç•«åª’æ": [{val:"illustration", label:"æ’ç•«"}, {val:"watercolor painting", label:"æ°´å½©"}, {val:"oil painting", label:"æ²¹ç•«"}, {val:"pencil sketch", label:"é‰›ç­†ç´ æ"}],
            "æµæ´¾": [{val:"Impressionnisme", label:"å°è±¡æ´¾"}, {val:"Surrealism", label:"è¶…ç¾å¯¦"}, {val:"Pop Art", label:"æ™®æ™®"}]
        },
        "anime": { 
            "é¢¨æ ¼ä½œå“": [{val: "Studio Ghibli style", label: "å‰åœåŠ›"}, {val: "One Piece style", label: "èˆªæµ·ç‹"}, {val: "Naruto style", label: "ç«å½±å¿è€…"}, {val: "Sailor Moon style", label: "ç¾å°‘å¥³æˆ°å£«"}]
        }
    };

    function init() {
        for (const [tabKey, categories] of Object.entries(categorizedData)) {
            const container = document.getElementById(`container-${tabKey}`);
            if (!container) continue;
            for (const [catName, items] of Object.entries(categories)) {
                const card = document.createElement('div'); card.className = 'category-card';
                card.innerHTML = `<label class="category-title">${catName}</label>`;
                const select = document.createElement('select'); select.className = 'form-select';
                if (items.length > 0 && items[0].id) select.id = items[0].id;
                select.appendChild(new Option("ä¸æŒ‡å®š", ""));
                items.forEach(item => select.appendChild(new Option(item.label, item.val)));
                card.appendChild(select); container.appendChild(card);
            }
        }
        document.getElementById('photo_type')?.addEventListener('change', checkLocks);
    }

    function checkLocks() {
        const photoType = document.getElementById('photo_type');
        const isPhoto = photoType && photoType.value !== "";
        // é–å®šå…‰åœˆ/ç„¦è·
        ['photo_aperture', 'photo_focal'].forEach(id => {
            const el = document.getElementById(id);
            if(el) { el.disabled = !isPhoto; if(!isPhoto) el.value=""; }
        });
        // å‡çµè—è¡“/å‹•æ¼«
        toggleLock('container-art', 'btn-art', isPhoto);
        toggleLock('container-anime', 'btn-anime', isPhoto);
    }

    function toggleLock(cid, bid, lock) {
        const c = document.getElementById(cid); const b = document.getElementById(bid);
        if(c) c.querySelectorAll('select').forEach(s => { s.disabled = lock; if(lock) s.value=""; });
        if(b) {
            b.classList.toggle('disabled-tab', lock);
            b.querySelector('.locked-badge').style.display = lock ? 'inline' : 'none';
        }
    }

    function setMode(mode) {
        const isStudy = mode === 'study';
        document.getElementById('mode-create').classList.toggle('active', !isStudy);
        document.getElementById('mode-study').classList.toggle('active', isStudy);
        document.getElementById('mainInputGroup').style.display = isStudy ? 'none' : 'flex';
        document.getElementById('cameraBtn').style.display = isStudy ? 'block' : 'none';
        document.getElementById('myTab').style.display = isStudy ? 'none' : 'flex';
        document.getElementById('study-hint').style.display = isStudy ? 'block' : 'none';
        document.getElementById('translationBox').style.display = isStudy ? 'block' : 'none';
        document.querySelectorAll('.tab-content-area').forEach(el => el.classList.remove('active'));
        if(!isStudy) document.getElementById('page-settings').classList.add('active');
        document.getElementById('actionBtn').textContent = isStudy ? "ğŸ” å•Ÿå‹•å­¸ç¿’åˆ†æ (Demo)" : "âœ¨ ç”¢å‡ºç¹ªåœ–æŒ‡ä»¤";
    }

    async function generatePrompt() {
        const isStudy = document.getElementById('mode-study').classList.contains('active');
        if (isStudy) {
            if (!document.getElementById('finalImage').src.includes('data:image')) return alert("è«‹å…ˆæ‹ç…§ï¼");
            document.getElementById('outputPrompt').value = "A realistic scene captured by smartphone camera, focus on details.";
            document.getElementById('translationPrompt').value = "ä¸€å¼µç”±æ‰‹æ©Ÿé¡é ­æ‹æ”çš„å¯«å¯¦å ´æ™¯ï¼Œå°ˆæ³¨æ–¼ç´°ç¯€ã€‚";
            return;
        }

        const parts = [];
        let sub = document.getElementById('mainSubject').value.trim();
        if(sub) parts.push(`Subject: ${sub},`);
        
        document.querySelectorAll('select').forEach(s => {
            if(s.value && !s.disabled && s.id !== 'aspectRatio') parts.push(s.value);
        });
        
        const ar = document.getElementById('aspectRatio').value;
        if(ar) parts.push(ar);
        
        document.getElementById('outputPrompt').value = parts.join(", ");
    }

    function speakText() {
        const text = document.getElementById('outputPrompt').value;
        if (!text) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'en-US'; u.rate = 0.8; window.speechSynthesis.speak(u);
    }

    function switchTab(btn, id) {
        if(btn.classList.contains('disabled-tab')) return;
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.tab-content-area').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function triggerCamera() { document.getElementById('cameraInput').click(); }
    function handleImageSelect(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('finalImage').src = e.target.result;
                document.getElementById('previewBox').style.display = 'block';
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
    function clearPhoto() {
        document.getElementById('finalImage').src = "";
        document.getElementById('previewBox').style.display = 'none';
    }

    init();
</script>
</body>
</html>
