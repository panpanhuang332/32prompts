<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>第一次AI生圖就上手 - 9527</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // 1. --- 貼上你的 Firebase 配置 ---
        const firebaseConfig = {
    apiKey: "AIzaSyA7wvE5K5S6PyALKOTM-PF7XNtikqEnCTQ", // 這裡最容易貼錯，請檢查前後有無空格
    authDomain: "first-ai-50594.firebaseapp.com",
    projectId: "first-ai-50594",
    storageBucket: "first-ai-50594.firebasestorage.app",
    messagingSenderId: "125060763248",
    appId: "1:125060763248:web:68f308de378e0568052eb5"
};

        // 2. --- 貼上你的 Gemini API Key ---
        const GEMINI_API_KEY = "AIzaSyABQ0n24ogxQqu75eio9fZJmE5qz3sk-HQ";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            const loginBtn = document.getElementById('loginBtn');
            const userInfo = document.getElementById('userInfo');
            const userImg = document.getElementById('userImg');
            const generateBtn = document.getElementById('generateBtn');
            if (user) {
                loginBtn.classList.add('hidden');
                userInfo.classList.remove('hidden');
                userImg.src = user.photoURL;
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'AI 思考並自動產圖 <i class="fas fa-magic ml-2"></i>';
            } else {
                loginBtn.classList.remove('hidden');
                userInfo.classList.add('hidden');
                generateBtn.disabled = true;
                generateBtn.innerText = "請先登入以開啟 AI 功能";
            }
        });

        // --- AI 思考與產圖邏輯 ---
        window.generateImage = async () => {
            const content = document.getElementById('content').value;
            if (!content) return alert("請輸入想畫的內容！");
            
            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loadingBox');
            const resultImg = document.getElementById('resultImg');
            
            btn.disabled = true;
            loading.classList.remove('hidden');
            
            try {
                // 第一步：呼叫 Gemini Thinking 優化指令
                const promptResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-thinking-preview:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `你是一位專業的繪圖提示詞工程師。請將以下主題思考並擴充成一段豐富、充滿細節的英文繪圖指令：${content}。請直接輸出指令，不要有其他廢話。` }] }]
                    })
                });
                const promptData = await promptResponse.json();
                const optimizedPrompt = promptData.candidates[0].content.parts[0].text;
                
                // 第二步：顯示優化後的指令
                document.getElementById('finalPrompt').innerText = optimizedPrompt;

                // 第三步：模擬 Imagen 產圖 (API 呼叫)
                // 注意：Imagen API 需在 Google Cloud 啟用，此處演示預覽邏輯
                resultImg.src = `https://pollinations.ai/p/${encodeURIComponent(optimizedPrompt)}?width=1024&height=1024&seed=${Math.floor(Math.random()*1000)}`;
                
                resultImg.onload = () => {
                    document.getElementById('resultBox').classList.remove('hidden');
                    loading.classList.add('hidden');
                    btn.disabled = false;
                };
            } catch (error) {
                console.error(error);
                alert("AI 思考失敗，請檢查 API Key 是否正確");
                loading.classList.add('hidden');
                btn.disabled = false;
            }
        };
    </script>

    <style>
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); font-family: sans-serif; }
        .app-card { border-radius: 40px; backdrop-filter: blur(20px); background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); }
        .gradient-text { background: linear-gradient(120deg, #818cf8, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="p-6 min-h-screen flex justify-center items-start text-white">

    <div class="w-full max-w-md space-y-6">
        <div class="flex justify-between items-center px-2">
            <div>
                <h1 class="text-2xl font-black italic tracking-tighter gradient-text">AI 產圖大師 9527</h1>
                <p class="text-slate-400 text-xs tracking-widest uppercase">Powered by Gemini 2.0</p>
            </div>
            <div id="authSection">
                <button id="loginBtn" onclick="login()" class="bg-indigo-600 px-4 py-2 rounded-full text-sm font-bold">登入</button>
                <div id="userInfo" class="hidden flex items-center gap-3">
                    <img id="userImg" class="w-10 h-10 rounded-full border-2 border-indigo-500">
                    <button onclick="logout()" class="text-[10px] text-slate-500">登出</button>
                </div>
            </div>
        </div>

        <div class="app-card p-8 space-y-8 shadow-2xl">
            <section>
                <label class="text-[10px] font-bold text-indigo-400 mb-3 block tracking-[0.2em]">STEP 01. 你的靈感</label>
                <textarea id="content" rows="3" placeholder="例如：一隻穿著西裝在月球上喝咖啡的橘貓..." class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:border-indigo-500 transition-all"></textarea>
            </section>

            <button id="generateBtn" disabled onclick="generateImage()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-all disabled:opacity-50">
                請先登入以開啟 AI 功能
            </button>

            <div id="loadingBox" class="hidden text-center space-y-4">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-indigo-500 border-t-transparent"></div>
                <p class="text-sm text-indigo-300 animate-pulse">Gemini 正在思考並繪圖中...</p>
            </div>

            <div id="resultBox" class="hidden space-y-6">
                <div class="rounded-3xl overflow-hidden border-2 border-indigo-500/30 shadow-2xl">
                    <img id="resultImg" src="" class="w-full h-auto">
                </div>
                <div class="bg-slate-900/80 p-4 rounded-2xl border border-slate-700">
                    <label class="text-[10px] text-indigo-400 font-bold block mb-2">AI 優化後的指令：</label>
                    <p id="finalPrompt" class="text-xs text-slate-300 font-mono italic"></p>
                </div>
            </div>
        </div>
    </div>

</body>
</html>


