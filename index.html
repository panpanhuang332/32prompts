<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 提示詞大師 9527</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://generativelanguage.googleapis.com;">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-2xl w-full space-y-8 text-center">
        <div>
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                AI 提示詞大師 9527
            </h1>
            <p class="text-gray-400 mt-2 text-lg">專為生圖設計的擴充助手</p>
        </div>

        <div class="bg-gray-800 p-6 rounded-xl border border-gray-700 shadow-2xl">
            <textarea id="userInput" rows="4" class="w-full bg-gray-900 p-4 rounded-lg border border-gray-600 focus:ring-2 focus:ring-blue-500 outline-none resize-none" placeholder="輸入中文想法（例如：一隻在森林裡喝茶的兔子）..."></textarea>
            
            <button id="generateBtn" class="w-full mt-4 bg-gradient-to-r from-blue-600 to-purple-600 py-3 rounded-lg font-bold hover:scale-105 transition duration-300">
                AI 立即擴充為專業提示詞
            </button>
        </div>

        <div id="statusArea" class="hidden">
            <p class="text-blue-400 italic loading-dots">Gemini 正在分析並擴充細節</p>
        </div>

        <div id="resultArea" class="space-y-4"></div>

        <div class="pt-8">
            <button onclick="resetKey()" class="text-xs text-gray-500 underline hover:text-gray-300">重設 API Key</button>
        </div>
    </div>

    <script>
        let API_KEY = localStorage.getItem('MY_AI_KEY');

        async function ensureKey() {
            if (!API_KEY || API_KEY.length < 10) {
                const key = prompt("請輸入您的 Gemini API Key：\n(此 Key 將安全儲存在您的瀏覽器中)");
                if (key && key.trim().length > 10) {
                    API_KEY = key.trim();
                    localStorage.setItem('MY_AI_KEY', API_KEY);
                }
            }
        }

        function resetKey() {
            localStorage.removeItem('MY_AI_KEY');
            location.reload();
        }

        const btn = document.getElementById('generateBtn');
        const input = document.getElementById('userInput');
        const status = document.getElementById('statusArea');
        const result = document.getElementById('resultArea');

        btn.addEventListener('click', async () => {
            const userText = input.value.trim();
            if (!userText) return alert('請先輸入想法');
            
            await ensureKey();
            if (!API_KEY) return;

            btn.disabled = true;
            status.classList.remove('hidden');
            result.innerHTML = '';

            // 使用最新的 Gemini 2.0 模型
            const URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;

            try {
                const response = await fetch(URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `你是一位繪圖提示詞專家。請根據這段中文描述： 「${userText}」，擴充成一段描述光影、材質、構圖的精美英文提示詞 (Prompt)。請只輸出英文，不要解釋。` }] }]
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const refinedPrompt = data.candidates[0].content.parts[0].text;
                status.classList.add('hidden');

                result.innerHTML = `
                    <div class="bg-gray-800 p-6 rounded-lg border border-blue-500/50 shadow-inner text-left">
                        <p class="text-blue-400 text-sm mb-2 font-bold uppercase tracking-widest">優化後的英文提示詞：</p>
                        <p id="promptText" class="text-lg text-gray-100 leading-relaxed mb-4">${refinedPrompt}</p>
                        <button onclick="copyText()" class="bg-blue-600/20 hover:bg-blue-600/40 text-blue-400 px-4 py-2 rounded border border-blue-600/50 text-sm transition">
                            一鍵複製提示詞
                        </button>
                    </div>
                `;
            } catch (e) {
                alert("獲取失敗：" + e.message + "\n\n請檢查專案 905215586222 是否已啟用 API。");
                status.classList.add('hidden');
            } finally {
                btn.disabled = false;
            }
        });

        function copyText() {
            const text = document.getElementById('promptText').innerText;
            navigator.clipboard.writeText(text).then(() => alert('已複製到剪貼簿！可直接貼到生圖工具。'));
        }

        window.onload = ensureKey;
    </script>
</body>
</html>
