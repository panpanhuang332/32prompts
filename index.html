<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MJ æç¤ºè©ç”¢ç”Ÿå™¨ (Mobile Fix)</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* --- æ ¸å¿ƒä½ˆå±€æ¨£å¼ --- */
        body {
            background-color: #f0f2f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ç¦æ­¢ç¶²é æ•´é«”æ²å‹• */
        }

        /* 1. é ‚éƒ¨å€åŸŸ */
        .app-header {
            background: white;
            padding: 15px 15px 0 15px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
            z-index: 10;
            flex-shrink: 0;
        }

        /* 2. åˆ†é æ¨™ç±¤æ¨£å¼ */
        .nav-tabs {
            border-bottom: none;
            flex-wrap: nowrap;
            overflow-x: auto;
            white-space: nowrap;
            gap: 5px; /* æŒ‰éˆ•é–“è· */
            padding-bottom: 5px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #6c757d;
            font-size: 0.95rem;
            padding: 8px 12px;
            border-radius: 20px; /* åœ“è§’æŒ‰éˆ• */
            background-color: #f8f9fa;
            transition: all 0.2s;
        }
        
        /* é¸ä¸­æ™‚çš„æ¨£å¼ */
        .nav-tabs .nav-link.active {
            color: white;
            background-color: #0d6efd; /* è—åº•ç™½å­— */
            font-weight: bold;
        }

        /* 3. ä¸­é–“å…§å®¹å€åŸŸ (å¯æ²å‹•) */
        .app-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: #f0f2f5;
            scroll-behavior: smooth;
        }

        /* éš±è—æœªé¸ä¸­çš„é é¢ */
        .tab-content-area {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        /* é¡¯ç¤ºé¸ä¸­çš„é é¢ */
        .tab-content-area.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡æ¨£å¼ */
        .category-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        
        .category-title {
            font-size: 0.9rem;
            font-weight: bold;
            color: #343a40;
            margin-bottom: 8px;
            display: block;
            border-left: 4px solid #0d6efd;
            padding-left: 8px;
        }

        /* 4. åº•éƒ¨å€åŸŸ */
        .app-footer {
            background: white;
            padding: 10px 15px;
            border-top: 1px solid #dee2e6;
            flex-shrink: 0;
            z-index: 20;
            padding-bottom: max(10px, env(safe-area-inset-bottom));
        }

        .loading-text { font-size: 0.8em; color: #0d6efd; margin-top: 5px; display: none; }
        .form-select { background-color: #f8f9fa; border: 1px solid #e9ecef; }
        .nav-tabs::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="app-header">
        <h6 class="mb-2 fw-bold text-dark">ğŸ¨ MJ æç¤ºè©ç”¢ç”Ÿå™¨</h6>
        
        <div class="mb-2">
            <div class="input-group">
                <input type="text" class="form-control" id="mainSubject" placeholder="æè¿°ç•«é¢ä¸»é«” (æ”¯æ´ä¸­æ–‡)...">
                <button class="btn btn-outline-primary" type="button" id="translateBtn" onclick="translateInput()">
                    ä¸­ç¿»è‹±
                </button>
            </div>
            <div id="translationStatus" class="loading-text">æ­£åœ¨ç¿»è­¯ä¸­...</div>
        </div>

        <div class="nav nav-tabs" id="myTab" role="tablist">
            <button class="nav-link active" onclick="switchTab(this, 'page-settings')">âš™ï¸ è¨­å®š</button>
            <button class="nav-link" onclick="switchTab(this, 'page-photo')">ğŸ“¸ æ”å½±</button>
            <button class="nav-link" onclick="switchTab(this, 'page-art')">ğŸ–Œï¸ è—è¡“</button>
            <button class="nav-link" onclick="switchTab(this, 'page-anime')">ğŸ§¸ å‹•æ¼«</button>
        </div>
    </div>

    <div class="app-content">
        
        <div id="page-settings" class="tab-content-area active">
            <div class="category-card">
                <label class="category-title">ğŸ“ åœ–ç‰‡æ¯”ä¾‹ (Aspect Ratio)</label>
                <select class="form-select" id="aspectRatio">
                    <option value="" selected>1:1 (é è¨­æ­£æ–¹å½¢)</option>
                    <optgroup label="æ©«å‘">
                        <option value="--ar 16:9">16:9 (å¯¬è¢å¹•/YT)</option>
                        <option value="--ar 21:9">21:9 (Notionå°é¢)</option>
                        <option value="--ar 4:3">4:3 (æ¨™æº–ç…§ç‰‡)</option>
                        <option value="--ar 3:2">3:2 (åº•ç‰‡)</option>
                    </optgroup>
                    <optgroup label="ç›´å‘">
                        <option value="--ar 4:5">4:5 (IG è²¼æ–‡)</option>
                        <option value="--ar 3:4">3:4 (ç›´å¼ç…§ç‰‡)</option>
                        <option value="--ar 9:16">9:16 (é™å‹•/Reels)</option>
                    </optgroup>
                </select>
            </div>

            <div class="category-card">
                <label class="category-title">ğŸ’ è§£æåº¦ (Resolution)</label>
                <select class="form-select" id="pixelResolution">
                    <option value="" selected>é è¨­</option>
                    <optgroup label="ç¤¾ç¾¤/è¢å¹•">
                        <option value="1080x1080 px, high quality">IG æ­£æ–¹å½¢ (1080p)</option>
                        <option value="1080x1920 px, full screen">IG é™å‹• (Full HD)</option>
                        <option value="3840x2160 px, 4K UHD">4K è¶…é«˜ç•«è³ª</option>
                    </optgroup>
                    <optgroup label="å°åˆ·/æ”å½±">
                        <option value="2480x3508 px, 300DPI">A4 å°åˆ·è¦æ ¼</option>
                        <option value="6000x4000 px, 24MP">2400 è¬åƒç´ </option>
                    </optgroup>
                </select>
            </div>
            
            <div class="text-center text-muted small mt-4 p-3">
                <p>ğŸ’¡ æç¤ºï¼š<br>é»é¸ä¸Šæ–¹æ¨™ç±¤åˆ‡æ›<br>æ”å½±ã€è—è¡“æˆ–å‹•æ¼«é¢¨æ ¼é¸å–®ã€‚</p>
            </div>
        </div>

        <div id="page-photo" class="tab-content-area">
            <div id="container-photo"></div>
        </div>

        <div id="page-art" class="tab-content-area">
            <div id="container-art"></div>
        </div>

        <div id="page-anime" class="tab-content-area">
            <div id="container-anime"></div>
        </div>

    </div>

    <div class="app-footer">
        <div class="d-grid gap-2 mb-2">
            <button class="btn btn-primary fw-bold" onclick="generatePrompt()">
                âœ¨ ç”¢å‡ºæç¤ºè©
            </button>
        </div>
        <div class="input-group input-group-sm">
            <textarea class="form-control" id="outputPrompt" rows="1" readonly placeholder="æç¤ºè©å°‡é¡¯ç¤ºæ–¼æ­¤" style="resize: none;"></textarea>
            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()">è¤‡è£½</button>
        </div>
    </div>

<script>
    // --- 1. åˆ†é åˆ‡æ›é‚è¼¯ (åŸç”Ÿ JSï¼Œä¸ä¾è³´ Bootstrap) ---
    function switchTab(btn, targetId) {
        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        document.querySelectorAll('.nav-link').forEach(b => {
            b.classList.remove('active');
            b.style.backgroundColor = '#f8f9fa'; // æ¢å¾©ç°åº•
            b.style.color = '#6c757d'; // æ¢å¾©ç°å­—
        });

        // è¨­å®šç•¶å‰æŒ‰éˆ•ç‚º active
        btn.classList.add('active');
        btn.style.backgroundColor = '#0d6efd'; // è—åº•
        btn.style.color = 'white'; // ç™½å­—

        // éš±è—æ‰€æœ‰é é¢å…§å®¹
        document.querySelectorAll('.tab-content-area').forEach(div => div.classList.remove('active'));

        // é¡¯ç¤ºç›®æ¨™é é¢
        const targetDiv = document.getElementById(targetId);
        if (targetDiv) {
            targetDiv.classList.add('active');
        }
    }

    // --- 2. è³‡æ–™åº«èˆ‡å…§å®¹ç”Ÿæˆ ---
    const categorizedData = {
        "photo": { 
            "é¡å‹ (Types)": [
                {val: "photo", label: "ç…§ç‰‡"}, {val: "portrait photography", label: "äººåƒæ”å½±"},
                {val: "life photo", label: "ç”Ÿæ´»ç…§"}, {val: "cinematic photo style", label: "é›»å½±åŠ‡ç…§"}
            ],
            "ç‰¹è‰² (Features)": [
                {val: "DSLR style", label: "æ•¸ä½å–®çœ¼"}, {val: "Polaroid style", label: "æ‹ç«‹å¾—"},
                {val: "8K", label: "8K ç•«è³ª"}, {val: "bokeh", label: "æ™¯æ·±/æ•£æ™¯"},
                {val: "golden hour", label: "é»ƒé‡‘æ™‚åˆ»"}, {val: "lens flare", label: "é¡é ­çœ©å…‰"}
            ],
            "ç•«é¢è§’åº¦ (Angles)": [
                {val: "face close-up", label: "è‡‰éƒ¨ç‰¹å¯«"}, {val: "full body shot", label: "å…¨èº«ç…§"},
                {val: "bird view", label: "é³¥ç°è¦–è§’"}, {val: "low angle view", label: "ä½è§’åº¦ä»°è¦–"},
                {val: "wide angle lens", label: "å»£è§’é¡é ­"}, {val: "macro lens", label: "å¾®è·é¡é ­"}
            ],
            "ç‰¹æ®Šæ•ˆæœ (Effects)": [
                {val: "knolling", label: "é–‹ç®±ç…§/å¹³é‹ª"}, {val: "product view", label: "ç”¢å“ç…§"},
                {val: "double exposure", label: "é‡è¤‡æ›å…‰"}, {val: "motion blur", label: "å‹•æ…‹æ¨¡ç³Š"}
            ]
        },
        "art": { 
            "ç¹ªç•«åª’æ (Mediums)": [
                {val: "illustration", label: "æ’ç•«"}, {val: "oil painting", label: "æ²¹ç•«"},
                {val: "watercolor painting", label: "æ°´å½©"}, {val: "pencil sketch", label: "ç´ æ"},
                {val: "ink drawing", label: "æ°´å¢¨ç•«"}, {val: "vector art", label: "å‘é‡åœ–"}
            ],
            "ææ–™æè³ª (Materials)": [
                {val: "paper art", label: "ç´™é›•"}, {val: "3D render", label: "3D æ¸²æŸ“"},
                {val: "stained glass", label: "å½©ç¹ªç»ç’ƒ"}, {val: "pixel art", label: "åƒç´ ç•«"},
                {val: "origami art", label: "æ‘ºç´™"}, {val: "neon light", label: "éœ“è™¹ç‡ˆ"}
            ],
            "è—è¡“æµæ´¾ (Movements)": [
                {val: "Impressionism", label: "å°è±¡æ´¾"}, {val: "Surrealism", label: "è¶…ç¾å¯¦ä¸»ç¾©"},
                {val: "Cyberpunk", label: "è³½åšé¾å…‹"}, {val: "Steampunk", label: "è’¸æ°£é¾å…‹"},
                {val: "Minimalism", label: "æ¥µç°¡ä¸»ç¾©"}, {val: "Pop Art", label: "æ™®æ™®è—è¡“"}
            ],
            "è—è¡“å®¶ (Artists)": [
                {val: "Vincent van Gogh", label: "æ¢µè°·"}, {val: "Hayao Miyazaki", label: "å®®å´é§¿"},
                {val: "Makoto Shinkai", label: "æ–°æµ·èª "}, {val: "Wes Anderson", label: "é­æ–¯å®‰å¾·æ£®"},
                {val: "Leonardo da Vinci", label: "é”æ–‡è¥¿"}, {val: "Andy Warhol", label: "å®‰è¿ªæ²ƒè·"}
            ]
        },
        "anime": { 
            "å‹•æ¼«é¡å‹ (Anime Type)": [
                {val: "2D cartoon", label: "2D å¡é€š"}, {val: "3D cartoon", label: "3D å¡é€š"},
                {val: "Anime style", label: "æ—¥ç³»å‹•ç•«"}, {val: "American comic book", label: "ç¾å¼æ¼«ç•«"}
            ],
            "å‹•ç•«å…¬å¸ (Studios)": [
                {val: "Ghibli Studio", label: "å‰åœåŠ›"}, {val: "Pixar Animation", label: "çš®å…‹æ–¯"},
                {val: "Disney Animation", label: "è¿ªå£«å°¼"}, {val: "Kyoto Animation", label: "äº¬éƒ½å‹•ç•«"}
            ],
            "ä½œå“é¢¨æ ¼ (Series)": [
                {val: "Demon Slayer", label: "é¬¼æ»…ä¹‹åˆƒ"}, {val: "Dragon ball", label: "ä¸ƒé¾ç "},
                {val: "Cyberpunk Edgerunners", label: "é‚Šç·£è¡Œè€…"}, {val: "JoJo", label: "JoJo"}
            ],
            "è¨­è¨ˆæ‡‰ç”¨ (Design)": [
                {val: "mascot logo", label: "å‰ç¥¥ç‰© Logo"}, {val: "UI design", label: "UI ä»‹é¢"},
                {val: "2D floor plan", label: "å¹³é¢å®¤å…§åœ–"}, {val: "character toy", label: "å…¬ä»”ç©å…·"},
                {val: "Encyclopedia of", label: "ç™¾ç§‘å…¨æ›¸åœ–è§£"}
            ]
        }
    };

    function init() {
        for (const [tabKey, categories] of Object.entries(categorizedData)) {
            const container = document.getElementById(`container-${tabKey}`);
            if (!container) continue; // å®‰å…¨æª¢æŸ¥
            
            for (const [catName, items] of Object.entries(categories)) {
                const card = document.createElement('div');
                card.className = 'category-card';
                
                const label = document.createElement('label');
                label.className = 'category-title';
                label.textContent = catName;
                card.appendChild(label);
                
                const select = document.createElement('select');
                select.className = 'form-select category-select';
                
                const defaultOpt = document.createElement('option');
                defaultOpt.value = "";
                defaultOpt.textContent = "ä¸æŒ‡å®š";
                select.appendChild(defaultOpt);
                
                items.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.val;
                    opt.textContent = item.label;
                    select.appendChild(opt);
                });
                
                card.appendChild(select);
                container.appendChild(card);
            }
        }
    }

    // --- 3. ç¿»è­¯èˆ‡ç”¢å‡ºåŠŸèƒ½ ---
    async function translateInput() {
        const inputEl = document.getElementById('mainSubject');
        const statusEl = document.getElementById('translationStatus');
        const text = inputEl.value.trim();
        if (!text) return;
        if (!/[\u4e00-\u9fa5]/.test(text)) return text;

        statusEl.style.display = 'block';
        document.getElementById('translateBtn').disabled = true;

        try {
            const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=zh-TW|en`);
            const data = await response.json();
            if (data.responseData?.translatedText) {
                inputEl.value = data.responseData.translatedText;
                statusEl.style.display = 'none';
                return data.responseData.translatedText;
            }
        } catch (e) { console.error(e); } 
        finally { 
            document.getElementById('translateBtn').disabled = false;
            statusEl.style.display = 'none';
        }
    }

    async function generatePrompt() {
        let mainSubject = document.getElementById('mainSubject').value.trim();
        const aspectRatio = document.getElementById('aspectRatio').value;
        const pixelRes = document.getElementById('pixelResolution').value;
        const btn = document.querySelector('.btn-primary');

        if (/[\u4e00-\u9fa5]/.test(mainSubject)) {
            const originalText = btn.textContent;
            btn.textContent = "â³ ç¿»è­¯ä¸­...";
            btn.disabled = true;
            mainSubject = await translateInput() || mainSubject;
            btn.textContent = originalText;
            btn.disabled = false;
        }

        let parts = [];
        if (mainSubject) parts.push(mainSubject);
        if (pixelRes) parts.push(pixelRes);

        document.querySelectorAll('.category-select').forEach(select => {
            if (select.value) parts.push(select.value);
        });

        parts.push("--v 6.0");
        if (aspectRatio) parts.push(aspectRatio);

        document.getElementById('outputPrompt').value = parts.join(', ');
    }

    function copyToClipboard() {
        const el = document.getElementById("outputPrompt");
        el.select();
        el.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(el.value);
    }

    // å•Ÿå‹•åˆå§‹åŒ–
    init();

    // è¨»å†Š Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
</script>
</body>
</html>
