<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ICS Lab Pro - V7.7 Logic Locked</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>tailwind.config = { darkMode: 'media' }</script>
    <style>
        body { -webkit-tap-highlight-color: transparent; transition: background-color 0.4s ease; }
        .app-card { border-radius: 32px; transition: all 0.3s ease; }
        .gradient-header { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
        @media (prefers-color-scheme: dark) { body { background-color: #0f172a; } }
        @keyframes dice-roll { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .rolling { animation: dice-roll 0.5s ease-in-out; }
        select { appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 1.2rem center; background-repeat: no-repeat; background-size: 1.2em; }
        select:disabled { opacity: 0.5; cursor: not-allowed; background-color: #f1f5f9; color: #94a3b8; }
        .hidden-option { display: none; }
    </style>
</head>
<body class="p-4 bg-slate-50 dark:bg-slate-900 min-h-screen font-sans pb-10 flex justify-center items-start">

    <div class="w-full max-w-md bg-white dark:bg-slate-800 app-card shadow-2xl overflow-hidden border border-gray-100 dark:border-slate-700">
        <div class="p-9 gradient-header text-white relative">
            <h1 class="text-3xl font-black italic flex items-center gap-3 relative z-10">
                <i class="fas fa-lock-open text-yellow-300"></i> ICS Lab Pro
            </h1>
            <p class="text-indigo-100 text-[10px] mt-2 font-bold tracking-[0.3em] opacity-90 uppercase relative z-10">V7.7 Smart Logic Controller</p>
            <button onclick="randomStyleOnly()" class="absolute bottom-6 right-6 bg-white/20 hover:bg-white/30 backdrop-blur-md p-3 rounded-2xl border border-white/30 transition-all active:scale-90 group shadow-lg">
                <i id="diceIcon" class="fas fa-dice text-2xl text-white"></i>
            </button>
        </div>

        <div class="p-7 space-y-8">
            <section>
                <label class="text-[10px] font-black text-indigo-500 dark:text-indigo-400 mb-3 block tracking-[0.2em] uppercase">Step 01. åœ–ç‰‡é¡å‹</label>
                <div class="grid grid-cols-3 gap-2">
                    <button id="type-general" onclick="vibrate(); setType('general', this)" class="type-btn ring-2 ring-indigo-500 bg-indigo-50 dark:bg-indigo-900/40 p-2.5 rounded-xl text-indigo-700 dark:text-indigo-300 text-[10px] font-bold transition-all">é€šç”¨åœ–åƒ</button>
                    <button id="type-infographic" onclick="vibrate(); setType('infographic', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-2.5 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">è³‡è¨Šåœ–è¡¨</button>
                    <button id="type-diagram" onclick="vibrate(); setType('diagram', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-2.5 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">åŠŸèƒ½åœ–è§£</button>
                    <button id="type-flowchart" onclick="vibrate(); setType('flowchart', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-2.5 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">æµç¨‹åœ–</button>
                    <button id="type-portrait" onclick="vibrate(); setType('portrait', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-2.5 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">äººåƒæ”å½±</button>
                    <button id="type-landscape" onclick="vibrate(); setType('landscape', this)" class="type-btn border border-gray-100 dark:border-slate-700 p-2.5 rounded-xl text-gray-500 dark:text-slate-400 text-[10px] font-medium transition-all">å£¯é—Šé¢¨æ™¯</button>
                </div>
            </section>

            <section>
                <label class="text-[10px] font-black text-indigo-500 mb-3 block tracking-[0.2em] uppercase">Step 02. å…§å®¹ä¸»é¡Œ</label>
                <textarea id="content" rows="2" placeholder="ä½ æƒ³å‘ˆç¾ä»€éº¼å…§å®¹ï¼Ÿ" class="w-full p-4 bg-gray-50 dark:bg-slate-900 border border-gray-100 rounded-2xl focus:ring-2 focus:ring-indigo-500 outline-none text-gray-700 dark:text-slate-200 transition-all text-sm shadow-inner"></textarea>
            </section>

            <section class="space-y-3">
                <label class="text-[10px] font-black text-indigo-500 block tracking-[0.2em] uppercase">Step 03. è¦–è¦ºé¢¨æ ¼ (æ¢ä»¶é–å®š)</label>
                
                <select id="styleCategory" onchange="vibrate(); updateTieredUI()" class="w-full p-4 bg-indigo-50/50 dark:bg-slate-900 border border-indigo-100 rounded-2xl font-black text-indigo-600 text-sm">
                    <option value="" disabled selected>1. é¸æ“‡é¢¨æ ¼åˆ†é¡...</option>
                    <option id="opt-pro-photo" value="ProPhotography">ğŸ“¸ å°ˆæ¥­æ”å½±èˆ‡åƒæ•¸ (æ”å½±å°ˆå±¬)</option>
                    <option value="Photography">ğŸ“· ä¸€èˆ¬æ”å½±èˆ‡ç…§ç‰‡é¢¨æ ¼</option>
                    <option value="Painting">ğŸ–Œï¸ ç¹ªç•«åª’æèˆ‡è³ªæ„Ÿ</option>
                    <option value="ArtMovements">ğŸ›ï¸ è—è¡“æµæ´¾èˆ‡æµæ´¾</option>
                    <option value="FamousArtists">ğŸ¨ çŸ¥åè—è¡“å®¶å¤§å¸«</option>
                    <option value="AnimeComics">ğŸ¬ å‹•ç•«èˆ‡æ¼«æ™</option>
                    <option value="DesignSpecial">âœ¨ ç‰¹æ®Šèˆ‡è¨­è¨ˆé¢¨æ ¼</option>
                </select>

                <select id="styleDetail" onchange="vibrate(); updatePreview()" class="w-full p-4 bg-gray-50 dark:bg-slate-900 border border-gray-100 rounded-2xl font-bold text-gray-700 text-sm" disabled>
                    <option value="">2. å†é¸æ“‡å…·é«”è¦æ ¼...</option>
                </select>

                <select id="proAssist" onchange="vibrate(); updatePreview()" class="w-full p-4 bg-gray-50 dark:bg-slate-900 border border-gray-100 rounded-2xl font-bold text-gray-700 text-sm" disabled>
                    <option value="" selected>3. å°ˆæ¥­æ”å½±è¼”åŠ©æè¿° (é–å®šä¸­)...</option>
                    <option value="bright">ç’°å¢ƒè¼ƒæ˜äº® Bright</option>
                    <option value="dark">ç’°å¢ƒè¼ƒæš— Dark</option>
                    <option value="realistic">é€¼çœŸçš„ Realistic</option>
                    <option value="very realistic">æ¥µè‡´é€¼çœŸ (å¼·èª¿ç´°ç¯€)</option>
                    <option value="8K">8K é ‚ç´šç•«è³ª</option>
                </select>

                <div id="previewCard" class="hidden p-4 rounded-2xl bg-slate-50 dark:bg-slate-900 border border-indigo-100 animate-in fade-in">
                    <p id="previewText" class="text-xs text-indigo-600 dark:text-indigo-300 leading-relaxed font-bold"></p>
                </div>
            </section>

            <section class="space-y-3">
                <label class="text-[10px] font-black text-indigo-500 block tracking-[0.2em] uppercase">Step 04. é•·å¯¬æ¯”ä¾‹</label>
                <select id="ratioSelect" onchange="vibrate(); handleRatioChange()" class="w-full p-4 bg-gray-50 dark:bg-slate-900 border border-gray-100 rounded-2xl font-bold text-gray-700 text-sm">
                    <option value="1:1">1:1 (æ­£æ–¹å½¢)</option>
                    <option value="9:16" selected>9:16 (çŸ­å½±éŸ³)</option>
                    <option value="16:9">16:9 (æ©«å‘è¦–è§’)</option>
                    <option value="21:9">21:9 (Notion å°é¢)</option>
                    <option value="custom">âœï¸ è‡ªè¨‚é•·å¯¬ (Custom)</option>
                </select>
                <div id="customRatioBox" class="hidden"><input type="text" id="customRatioInput" placeholder="ä¾‹å¦‚ 2.35:1" class="w-full p-3 border rounded-xl"></div>
            </section>

            <button onclick="vibrate(); generate()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-4 rounded-2xl shadow-xl active:scale-[0.96] flex justify-center items-center gap-2 text-lg">
                ç”Ÿæˆç´”æ·¨å¤§å¸«æŒ‡ä»¤ <i class="fas fa-magic"></i>
            </button>

            <div id="resultBox" class="hidden animate-in zoom-in-95 duration-300">
                <div class="bg-slate-900 rounded-[2rem] p-7 border border-slate-700 shadow-2xl relative">
                    <p id="finalPrompt" class="text-indigo-200 text-xs font-mono whitespace-pre-line leading-relaxed bg-slate-950 p-5 rounded-2xl border border-white/5 shadow-inner mb-6"></p>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="vibrate(); copyText()" class="bg-indigo-600 text-white p-4 rounded-xl flex items-center justify-center"><i class="far fa-copy"></i></button>
                        <button onclick="vibrate(); shareLine()" class="bg-[#06C755] text-white p-4 rounded-xl flex items-center justify-center"><i class="fab fa-line text-lg"></i></button>
                        <button onclick="vibrate(); shareFB()" class="bg-[#1877F2] text-white p-4 rounded-xl flex items-center justify-center"><i class="fab fa-facebook text-lg"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- å®Œæ•´é¢¨æ ¼è³‡æ–™èˆ‡å°ç…§è¡¨ ---
        const categoryMap = {
            "ProPhotography": ["macro lens", "prime lens", "long focal length lens", "wide angle lens", "fish eye lens", "tilt shift lens", "bokeh", "magic hour", "golden hour", "blue hour", "lens flare", "multiple exposure", "panning", "motion blur", "vgnetting", "ambient light", "hard light", "soft light", "back light", "rim light", "HDR", "4K HDR"],
            "Photography": ["Photo", "life photo", "group photo", "portrait photography", "DSLR style", "Polaroid style", "Fujifilm", "Calotype print", "Albumen print", "movie style", "cinematic photo style"],
            "Painting": ["Oil Painting", "Watercolor", "Sketch", "Ink Drawing", "Ukiyo-e"],
            "ArtMovements": ["Renaissance", "Impressionism", "Surrealism", "Pop Art", "Minimalism", "Cyberpunk"],
            "FamousArtists": ["Da Vinci", "Van Gogh", "Picasso", "Dali", "Monet", "Kusama Yayoi"],
            "AnimeComics": ["Disney Animation", "Pixar", "Studio Ghibli", "Anime", "Manga", "American Comic", "Claymation"],
            "DesignSpecial": ["Logo Design", "Flat Design", "Infographic", "Blueprint", "Origami", "Pixel Art", "Isometric 3D", "LEGO"]
        };

        const styleDisplayNames = {
            "macro lens": "å¾®è·é¡é ­ Macro", "prime lens": "å®šç„¦é¡é ­ Prime", "long focal length lens": "æœ›é é¡é ­ Tele", "wide angle lens": "å»£è§’é¡é ­ Wide", "fish eye lens": "é­šçœ¼é¡é ­ Fish-eye", "tilt shift lens": "ç§»è»¸é¡é ­ Tilt-shift", "bokeh": "æ•£æ™¯æ•ˆæœ Bokeh", "magic hour": "é­”å¹»æ™‚åˆ» Magic Hour", "golden hour": "é»ƒé‡‘æ™‚åˆ» Golden Hour", "blue hour": "è—è‰²æ™‚åˆ» Blue Hour", "lens flare": "é¡é ­çœ©å…‰ Flare", "multiple exposure": "é‡è¤‡æ›å…‰ Exposure", "panning": "å¹³ç§»æ‹æ” Panning", "motion blur": "å‹•æ…‹æ¨¡ç³Š Motion", "vgnetting": "æšˆå½±æš—è§’ Vignette", "ambient light": "ç’°å¢ƒå…‰ Ambient", "hard light": "ç¡¬å…‰æ‰“æ³• Hard", "soft light": "æŸ”å…‰æ‰“æ³• Soft", "back light": "èƒŒå…‰å‰ªå½± Backlight", "rim light": "è¼ªå»“å…‰ Rim", "HDR": "é«˜å‹•æ…‹ç¯„åœ HDR", "4K HDR": "æ¥µè‡´ 4K HDR",
            "Photo": "æ¨™æº–ç…§ç‰‡ Photo", "life photo": "ç”Ÿæ´»ç…§ Life", "group photo": "åœ˜é«”ç…§ Group", "portrait photography": "äººåƒæ”å½± Portrait", "DSLR style": "å–®çœ¼é¢¨æ ¼ DSLR", "Polaroid style": "æ‹ç«‹å¾— Polaroid", "Fujifilm": "å¯Œå£«åº•ç‰‡ Fujifilm", "Oil Painting": "å¤å…¸æ²¹ç•« Oil", "Sketch": "ç´ æè‰åœ– Sketch", "Anime": "æ—¥æœ¬å‹•æ¼« Anime"
        };

        let selectedType = 'general';
        let history = JSON.parse(localStorage.getItem('prompt_history_v77') || '[]');

        function vibrate() { if (navigator.vibrate) navigator.vibrate(15); }

        function handleRatioChange() {
            const s = document.getElementById('ratioSelect');
            document.getElementById('customRatioBox').className = s.value === 'custom' ? 'block' : 'hidden';
        }

        // --- æ ¸å¿ƒé–å®šé‚è¼¯ï¼šStep 01 å½±éŸ¿ Step 03 é¸é … ---
        function setType(type, btn) {
            selectedType = type;
            document.querySelectorAll('.type-btn').forEach(b => b.className = 'type-btn border border-gray-100 p-2.5 rounded-xl text-gray-500 text-[10px] font-medium transition-all');
            btn.className = 'type-btn ring-2 ring-indigo-500 bg-indigo-50 p-2.5 rounded-xl text-indigo-700 text-[10px] font-bold transition-all shadow-sm';

            const proOption = document.getElementById('opt-pro-photo');
            const allowedTypes = ['general', 'landscape', 'portrait'];
            
            if (allowedTypes.includes(type)) {
                proOption.disabled = false;
                proOption.text = "ğŸ“¸ å°ˆæ¥­æ”å½±èˆ‡åƒæ•¸ (æ”å½±å°ˆå±¬)";
            } else {
                proOption.disabled = true;
                proOption.text = "ğŸ“¸ å°ˆæ¥­æ”å½±èˆ‡åƒæ•¸ (åƒ…é™æ”å½±é¡å‹)";
                // å¦‚æœç›®å‰å‰›å¥½é¸åœ¨å°ˆæ¥­æ”å½±ä¸Šï¼Œå‰‡å¼·åˆ¶é‡ç½®
                if (document.getElementById('styleCategory').value === "ProPhotography") {
                    document.getElementById('styleCategory').value = "";
                    updateTieredUI();
                }
            }
        }

        function updateTieredUI(defaultStyle = "") {
            const cat = document.getElementById('styleCategory').value;
            const detail = document.getElementById('styleDetail');
            const assist = document.getElementById('proAssist');

            detail.innerHTML = '<option value="">2. å†é¸æ“‡å…·é«”è¦æ ¼...</option>';
            detail.disabled = !cat;
            if (cat && categoryMap[cat]) {
                categoryMap[cat].forEach(k => {
                    const opt = document.createElement('option');
                    opt.value = k; opt.textContent = styleDisplayNames[k] || k;
                    detail.appendChild(opt);
                });
                if (defaultStyle) detail.value = defaultStyle;
            }

            // å°ˆæ¥­æ”å½±è¼”åŠ©è§£é–é‚è¼¯
            if (cat === "ProPhotography" || cat === "Photography") {
                assist.disabled = false;
                assist.options[0].textContent = "3. å°ˆæ¥­æ”å½±è¼”åŠ© (é¸å¡«)...";
            } else {
                assist.disabled = true;
                assist.value = "";
                assist.options[0].textContent = "3. å°ˆæ¥­æ”å½±è¼”åŠ© (åƒ…é™æ”å½±é¡)...";
            }
            updatePreview();
        }

        function randomStyleOnly() {
            vibrate();
            const icon = document.getElementById('diceIcon');
            icon.classList.add('rolling'); setTimeout(() => icon.classList.remove('rolling'), 500);
            
            const allowedTypes = ['general', 'landscape', 'portrait'];
            let cats = Object.keys(categoryMap);
            // éš¨æ©Ÿæ™‚ä¹Ÿå— Step 01 é™åˆ¶
            if (!allowedTypes.includes(selectedType)) {
                cats = cats.filter(c => c !== "ProPhotography");
            }
            
            const randomCat = cats[Math.floor(Math.random() * cats.length)];
            document.getElementById('styleCategory').value = randomCat;
            updateTieredUI(categoryMap[randomCat][Math.floor(Math.random() * categoryMap[randomCat].length)]);
        }

        function updatePreview() {
            const d = document.getElementById('styleDetail').value;
            const card = document.getElementById('previewCard');
            if (d) { document.getElementById('previewText').innerText = "ğŸ’¡ é¢¨æ ¼å·²é–å®šï¼Œæº–å‚™ç”Ÿæˆç„¡æ–‡å­—æŒ‡ä»¤ã€‚"; card.classList.remove('hidden'); }
            else { card.classList.add('hidden'); }
        }

        function generate() {
            const content = document.getElementById('content').value.trim() || "Masterpiece";
            const style = document.getElementById('styleDetail').value;
            const assist = document.getElementById('proAssist').value;
            if(!style) return alert('è«‹é¸æ“‡è¦–è¦ºé¢¨æ ¼ï¼');
            
            const ratioSelect = document.getElementById('ratioSelect').value;
            let arValue = ratioSelect === 'custom' ? (document.getElementById('customRatioInput').value || "1:1") : ratioSelect;
            
            const prompt = `/imagine prompt: A ${style} ${assist || ""} style ${selectedType} showcasing ${content} --ar ${arValue} --no text, words, letters, font, watermark, logo, signature --v 6.1`;
            
            document.getElementById('finalPrompt').innerText = prompt;
            document.getElementById('resultBox').classList.remove('hidden');
        }

        function copyText() { navigator.clipboard.writeText(document.getElementById('finalPrompt').innerText); alert('æŒ‡ä»¤å·²è¤‡è£½ï¼'); }
        function shareLine() { window.open(`https://line.me/R/msg/text/?${encodeURIComponent(document.getElementById('finalPrompt').innerText)}`); }
        function shareFB() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${window.location.href}`); }
    </script>
</body>
</html>
